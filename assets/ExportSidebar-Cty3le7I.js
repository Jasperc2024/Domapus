import{c as de,a as we,b as ft,j as e,u as mt,P as re,d as Z,e as ue,f as Ae,g as _e,h as pt,i as ht,k as xt,l as gt,m as fe,n as vt,o as bt,p as wt,q as yt,t as Fe,r as je,D as Se,S as Nt,s as jt,v as St,w as Rt,x as Ct,y as Et,I as kt,X as Mt,C as pe,B as Re}from"./index-CKx7DenB.js";import{b as o}from"./charts-AC_n-Gm3.js";import{h as It,E as At}from"./pdf-export-C9FlfLes.js";import"./maplibre-DtjTm36r.js";const _t=de("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const Ft=de("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);const Pt=de("Microscope",[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]]);const Lt=de("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);var he="rovingFocusGroup.onEntryFocus",Tt={bubbles:!1,cancelable:!0},ae="RovingFocusGroup",[ve,Pe,Dt]=ft(ae),[Ot,Le]=we(ae,[Dt]),[Gt,zt]=Ot(ae),Te=o.forwardRef((t,a)=>e.jsx(ve.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(ve.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Bt,{...t,ref:a})})}));Te.displayName=ae;var Bt=o.forwardRef((t,a)=>{const{__scopeRovingFocusGroup:s,orientation:r,loop:l=!1,dir:i,currentTabStopId:f,defaultCurrentTabStopId:u,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:p=!1,...x}=t,R=o.useRef(null),g=ue(a,R),y=Ae(i),[k,h]=_e({prop:f,defaultProp:u??null,onChange:c,caller:ae}),[M,T]=o.useState(!1),v=pt(d),N=Pe(s),P=o.useRef(!1),[K,X]=o.useState(0);return o.useEffect(()=>{const C=R.current;if(C)return C.addEventListener(he,v),()=>C.removeEventListener(he,v)},[v]),e.jsx(Gt,{scope:s,orientation:r,dir:y,loop:l,currentTabStopId:k,onItemFocus:o.useCallback(C=>h(C),[h]),onItemShiftTab:o.useCallback(()=>T(!0),[]),onFocusableItemAdd:o.useCallback(()=>X(C=>C+1),[]),onFocusableItemRemove:o.useCallback(()=>X(C=>C-1),[]),children:e.jsx(re.div,{tabIndex:M||K===0?-1:0,"data-orientation":r,...x,ref:g,style:{outline:"none",...t.style},onMouseDown:Z(t.onMouseDown,()=>{P.current=!0}),onFocus:Z(t.onFocus,C=>{const Q=!P.current;if(C.target===C.currentTarget&&Q&&!M){const V=new CustomEvent(he,Tt);if(C.currentTarget.dispatchEvent(V),!V.defaultPrevented){const U=N().filter(E=>E.focusable),S=U.find(E=>E.active),_=U.find(E=>E.id===k),A=[S,_,...U].filter(Boolean).map(E=>E.ref.current);Ge(A,p)}}P.current=!1}),onBlur:Z(t.onBlur,()=>T(!1))})})}),De="RovingFocusGroupItem",Oe=o.forwardRef((t,a)=>{const{__scopeRovingFocusGroup:s,focusable:r=!0,active:l=!1,tabStopId:i,children:f,...u}=t,c=mt(),d=i||c,p=zt(De,s),x=p.currentTabStopId===d,R=Pe(s),{onFocusableItemAdd:g,onFocusableItemRemove:y,currentTabStopId:k}=p;return o.useEffect(()=>{if(r)return g(),()=>y()},[r,g,y]),e.jsx(ve.ItemSlot,{scope:s,id:d,focusable:r,active:l,children:e.jsx(re.span,{tabIndex:x?0:-1,"data-orientation":p.orientation,...u,ref:a,onMouseDown:Z(t.onMouseDown,h=>{r?p.onItemFocus(d):h.preventDefault()}),onFocus:Z(t.onFocus,()=>p.onItemFocus(d)),onKeyDown:Z(t.onKeyDown,h=>{if(h.key==="Tab"&&h.shiftKey){p.onItemShiftTab();return}if(h.target!==h.currentTarget)return;const M=Ut(h,p.orientation,p.dir);if(M!==void 0){if(h.metaKey||h.ctrlKey||h.altKey||h.shiftKey)return;h.preventDefault();let v=R().filter(N=>N.focusable).map(N=>N.ref.current);if(M==="last")v.reverse();else if(M==="prev"||M==="next"){M==="prev"&&v.reverse();const N=v.indexOf(h.currentTarget);v=p.loop?$t(v,N+1):v.slice(N+1)}setTimeout(()=>Ge(v))}}),children:typeof f=="function"?f({isCurrentTabStop:x,hasTabStop:k!=null}):f})})});Oe.displayName=De;var Vt={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ht(t,a){return a!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Ut(t,a,s){const r=Ht(t.key,s);if(!(a==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(a==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Vt[r]}function Ge(t,a=!1){const s=document.activeElement;for(const r of t)if(r===s||(r.focus({preventScroll:a}),document.activeElement!==s))return}function $t(t,a){return t.map((s,r)=>t[(a+r)%t.length])}var Kt=Te,Wt=Oe,ye="Radio",[qt,ze]=we(ye),[Yt,Zt]=qt(ye),Be=o.forwardRef((t,a)=>{const{__scopeRadio:s,name:r,checked:l=!1,required:i,disabled:f,value:u="on",onCheck:c,form:d,...p}=t,[x,R]=o.useState(null),g=ue(a,h=>R(h)),y=o.useRef(!1),k=x?d||!!x.closest("form"):!0;return e.jsxs(Yt,{scope:s,checked:l,disabled:f,children:[e.jsx(re.button,{type:"button",role:"radio","aria-checked":l,"data-state":$e(l),"data-disabled":f?"":void 0,disabled:f,value:u,...p,ref:g,onClick:Z(t.onClick,h=>{l||c?.(),k&&(y.current=h.isPropagationStopped(),y.current||h.stopPropagation())})}),k&&e.jsx(Ue,{control:x,bubbles:!y.current,name:r,value:u,checked:l,required:i,disabled:f,form:d,style:{transform:"translateX(-100%)"}})]})});Be.displayName=ye;var Ve="RadioIndicator",He=o.forwardRef((t,a)=>{const{__scopeRadio:s,forceMount:r,...l}=t,i=Zt(Ve,s);return e.jsx(ht,{present:r||i.checked,children:e.jsx(re.span,{"data-state":$e(i.checked),"data-disabled":i.disabled?"":void 0,...l,ref:a})})});He.displayName=Ve;var Xt="RadioBubbleInput",Ue=o.forwardRef(({__scopeRadio:t,control:a,checked:s,bubbles:r=!0,...l},i)=>{const f=o.useRef(null),u=ue(f,i),c=xt(s),d=gt(a);return o.useEffect(()=>{const p=f.current;if(!p)return;const x=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(x,"checked").set;if(c!==s&&g){const y=new Event("click",{bubbles:r});g.call(p,s),p.dispatchEvent(y)}},[c,s,r]),e.jsx(re.input,{type:"radio","aria-hidden":!0,defaultChecked:s,...l,tabIndex:-1,ref:u,style:{...l.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ue.displayName=Xt;function $e(t){return t?"checked":"unchecked"}var Jt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],me="RadioGroup",[Qt]=we(me,[Le,ze]),Ke=Le(),We=ze(),[er,tr]=Qt(me),qe=o.forwardRef((t,a)=>{const{__scopeRadioGroup:s,name:r,defaultValue:l,value:i,required:f=!1,disabled:u=!1,orientation:c,dir:d,loop:p=!0,onValueChange:x,...R}=t,g=Ke(s),y=Ae(d),[k,h]=_e({prop:i,defaultProp:l??null,onChange:x,caller:me});return e.jsx(er,{scope:s,name:r,required:f,disabled:u,value:k,onValueChange:h,children:e.jsx(Kt,{asChild:!0,...g,orientation:c,dir:y,loop:p,children:e.jsx(re.div,{role:"radiogroup","aria-required":f,"aria-orientation":c,"data-disabled":u?"":void 0,dir:y,...R,ref:a})})})});qe.displayName=me;var Ye="RadioGroupItem",Ze=o.forwardRef((t,a)=>{const{__scopeRadioGroup:s,disabled:r,...l}=t,i=tr(Ye,s),f=i.disabled||r,u=Ke(s),c=We(s),d=o.useRef(null),p=ue(a,d),x=i.value===l.value,R=o.useRef(!1);return o.useEffect(()=>{const g=k=>{Jt.includes(k.key)&&(R.current=!0)},y=()=>R.current=!1;return document.addEventListener("keydown",g),document.addEventListener("keyup",y),()=>{document.removeEventListener("keydown",g),document.removeEventListener("keyup",y)}},[]),e.jsx(Wt,{asChild:!0,...u,focusable:!f,active:x,children:e.jsx(Be,{disabled:f,required:i.required,checked:x,...c,...l,name:i.name,ref:p,onCheck:()=>i.onValueChange(l.value),onKeyDown:Z(g=>{g.key==="Enter"&&g.preventDefault()}),onFocus:Z(l.onFocus,()=>{R.current&&d.current?.click()})})})});Ze.displayName=Ye;var rr="RadioGroupIndicator",Xe=o.forwardRef((t,a)=>{const{__scopeRadioGroup:s,...r}=t,l=We(s);return e.jsx(He,{...l,...r,ref:a})});Xe.displayName=rr;var Je=qe,Qe=Ze,sr=Xe;const be=o.forwardRef(({className:t,...a},s)=>e.jsx(Je,{className:fe("grid gap-2",t),...a,ref:s}));be.displayName=Je.displayName;const te=o.forwardRef(({className:t,...a},s)=>e.jsx(Qe,{ref:s,className:fe("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:e.jsx(sr,{className:"flex items-center justify-center",children:e.jsx(_t,{className:"h-2.5 w-2.5 fill-current text-current"})})}));te.displayName=Qe.displayName;var ar=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],or=ar.reduce((t,a)=>{const s=vt(`Primitive.${a}`),r=o.forwardRef((l,i)=>{const{asChild:f,...u}=l,c=f?s:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(c,{...u,ref:i})});return r.displayName=`Primitive.${a}`,{...t,[a]:r}},{}),nr="Label",et=o.forwardRef((t,a)=>e.jsx(or.label,{...t,ref:a,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(t.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));et.displayName=nr;var tt=et;const ir=bt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Y=o.forwardRef(({className:t,...a},s)=>e.jsx(tt,{ref:s,className:fe(ir(),t),...a}));Y.displayName=tt.displayName;function lr(t,a,s={}){const r={type:"Feature"};return(s.id===0||s.id)&&(r.id=s.id),s.bbox&&(r.bbox=s.bbox),r.properties={},r.geometry=t,r}function xe(t,a,s={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ce(t[0])||!Ce(t[1]))throw new Error("coordinates must contain numbers");return lr({type:"Point",coordinates:t},a,s)}function cr(t,a={}){const s={type:"FeatureCollection"};return a.id&&(s.id=a.id),a.bbox&&(s.bbox=a.bbox),s.features=t,s}function Ce(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function rt(t,a,s){if(t!==null)for(var r,l,i,f,u,c,d,p=0,x=0,R,g=t.type,y=g==="FeatureCollection",k=g==="Feature",h=y?t.features.length:1,M=0;M<h;M++){d=y?t.features[M].geometry:k?t.geometry:t,R=d?d.type==="GeometryCollection":!1,u=R?d.geometries.length:1;for(var T=0;T<u;T++){var v=0,N=0;if(f=R?d.geometries[T]:d,f!==null){c=f.coordinates;var P=f.type;switch(p=0,P){case null:break;case"Point":if(a(c,x,M,v,N)===!1)return!1;x++,v++;break;case"LineString":case"MultiPoint":for(r=0;r<c.length;r++){if(a(c[r],x,M,v,N)===!1)return!1;x++,P==="MultiPoint"&&v++}P==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(r=0;r<c.length;r++){for(l=0;l<c[r].length-p;l++){if(a(c[r][l],x,M,v,N)===!1)return!1;x++}P==="MultiLineString"&&v++,P==="Polygon"&&N++}P==="Polygon"&&v++;break;case"MultiPolygon":for(r=0;r<c.length;r++){for(N=0,l=0;l<c[r].length;l++){for(i=0;i<c[r][l].length-p;i++){if(a(c[r][l][i],x,M,v,N)===!1)return!1;x++}N++}v++}break;case"GeometryCollection":for(r=0;r<f.geometries.length;r++)if(rt(f.geometries[r],a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function dr(t,a={}){if(t.bbox!=null&&a.recompute!==!0)return t.bbox;const s=[1/0,1/0,-1/0,-1/0];return rt(t,r=>{s[0]>r[0]&&(s[0]=r[0]),s[1]>r[1]&&(s[1]=r[1]),s[2]<r[0]&&(s[2]=r[0]),s[3]<r[1]&&(s[3]=r[1])}),s}var ur=dr;const fr="/Domapus/",le=["#FFF9B0","#FFEB84","#FFD166","#FF9A56","#E84C61","#C13584","#7B2E8D","#2E0B59"],Ee=1200,ke=900,ce=.15;function Me(t,a){if(!t)return 0;const s=t[a];return typeof s=="number"&&isFinite(s)?s:0}function mr(t,a=8){const s=[...t].filter(c=>c>0).sort((c,d)=>c-d);if(s.length===0)return[];const r=s[0],l=s[s.length-1],i=[],f=(l-r)*1e-6||1e-6,u=c=>s[Math.floor(c*(s.length-1))];for(let c=1;c<a;c++){let d=u(c/a);i.length&&d<=i[i.length-1]&&(d=i[i.length-1]+f),i.push(d)}return i}const pr=t=>({zhvi:"Zillow Home Value Index",median_sale_price:"Median Sale Price",median_ppsf:"Median Price per Sq Ft",avg_sale_to_list_ratio:"Sale-to-List Ratio",median_dom:"Median Days on Market"})[t]||t.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),hr=()=>new Date(new Date().setMonth(new Date().getMonth()-1)).toLocaleDateString("en-US",{month:"long",year:"numeric"});function ge(t,a){const s=a.toLowerCase();return s.includes("price")||s.includes("zhvi")?`$${(t/1e3).toFixed(0)}k`:s.includes("ratio")?`${t.toFixed(1)}%`:t.toLocaleString()}function xr(t,a){if(!t||t.length===0)return a.map(()=>0);const s=[...t].sort((r,l)=>r-l);return a.map(r=>{const l=(s.length-1)*r,i=Math.floor(l),f=Math.ceil(l),u=l-i;return s[i]*(1-u)+s[f]*u})}const st=o.forwardRef(({filteredData:t,selectedMetric:a,regionScope:s,regionName:r,includeLegend:l,includeTitle:i,showCities:f=!1,onReady:u},c)=>{const d=o.useRef(null),p=o.useRef(null),x=o.useRef(null),R=o.useRef(null),g=o.useRef({}),[y,k]=o.useState(!1),[h,M]=o.useState(1);o.useEffect(()=>{const S=()=>{if(d.current&&d.current.parentElement){const F=d.current.parentElement,A=F.clientWidth,E=F.clientHeight,D=A/Ee,G=E/ke,b=Math.min(D,G);M(b),Object.values(g.current).forEach(I=>I?.resize())}};S();const _=new ResizeObserver(S);return d.current?.parentElement&&_.observe(d.current.parentElement),()=>_.disconnect()},[]);const T=o.useMemo(()=>{const S={};return t.forEach(_=>{S[_.zipCode]=_}),S},[t]),{alaskaZips:v,hawaiiZips:N,mainlandZips:P,alaskaBounds:K,hawaiiBounds:X,mainlandBounds:C}=o.useMemo(()=>{const S=new Set,_=new Set,F=new Set,A=[],E=[],D=[];t.forEach(b=>{const I=(b.state??"").toString().toLowerCase(),z=I==="ak"||I==="alaska",$=I==="hi"||I==="hawaii",n=b.latitude||b.lat,j=b.longitude||b.lng;!n||!j||(z?(S.add(b.zipCode),j<0&&A.push(xe([j,n]))):$?(_.add(b.zipCode),E.push(xe([j,n]))):(F.add(b.zipCode),D.push(xe([j,n]))))});const G=b=>{if(b.length===0)return null;const I=ur(cr(b));let[z,$,n,j]=I;return z-=ce,$-=ce,n+=ce,j+=ce,[[z,$],[n,j]]};return{alaskaZips:S,hawaiiZips:_,mainlandZips:F,alaskaBounds:G(A),hawaiiBounds:G(E),mainlandBounds:G(D)}},[t]),Q=o.useMemo(()=>mr(t.map(S=>Me(S,a))),[t,a]),V=o.useMemo(()=>t.map(S=>S[a]).filter(S=>typeof S=="number"&&S>0),[t,a]),U=o.useMemo(()=>{if(V.length===0)return{min:"N/A",mid:"N/A",max:"N/A"};const[S,_,F]=xr(V,[.05,.5,.95]);return{min:ge(S,a),mid:ge(_,a),max:ge(F,a)}},[V,a]);return o.useImperativeHandle(c,()=>({getElement:()=>d.current})),o.useEffect(()=>{if(wt(),k(!1),Object.keys(g.current).forEach(b=>{g.current[b]?.remove(),g.current[b]=null}),t.length===0){u?.();return}const S=new URL(`${fr}data/us_zip_codes.pmtiles`,window.location.origin).href,_=["step",["coalesce",["feature-state","metricValue"],0],"#efefef",1e-6,le[0],...Q.flatMap((b,I)=>[b,le[Math.min(I+1,le.length-1)]])];let F=0;const A=s==="national"?1+(v.size>0?1:0)+(N.size>0?1:0):1;let E=!1;const D=()=>{F>=A&&!E&&(E=!0,k(!0),u?.())},G=(b,I,z,$)=>{if(!b)return;const n=new yt.Map({container:b,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",pixelRatio:2,interactive:!1,attributionControl:!1,fadeDuration:0,renderWorldCopies:!0});g.current[I]=n,n.on("load",()=>{try{if(n.resize(),z){const m=I==="alaska"||I==="hawaii"?20:40;z.flat().every(B=>Number.isFinite(B))&&n.fitBounds(z,{padding:m,animate:!1,maxZoom:I==="main"?12:6})}const j=n.getStyle();let O;j&&j.layers&&j.layers.forEach(m=>{const w=m.id,B=m["source-layer"],J=w.includes("place_city"),se=B==="water",H=w.includes("boundary_country")||w.includes("boundary_state");J?(O||(O=w),n.setLayoutProperty(w,"visibility",f?"visible":"none")):se||H?n.setLayoutProperty(w,"visibility","visible"):n.setLayoutProperty(w,"visibility","none")}),n.addSource("zips",{type:"vector",url:`pmtiles://${S}`,promoteId:"ZCTA5CE20"});const L=$?["in",["get","ZCTA5CE20"],["literal",Array.from($)]]:["has","ZCTA5CE20"];n.addLayer({id:"zips-fill",type:"fill",source:"zips","source-layer":"us_zip_codes",filter:L,paint:{"fill-color":_,"fill-opacity":.9}},O),n.addLayer({id:"zips-border",type:"line",source:"zips","source-layer":"us_zip_codes",filter:L,paint:{"line-color":"rgba(0,0,0,0.1)","line-width":.5}},O),($||new Set(t.map(m=>m.zipCode))).forEach(m=>{const w=T[m];w&&n.setFeatureState({source:"zips",sourceLayer:"us_zip_codes",id:m},{metricValue:Me(w,a)})}),n.triggerRepaint();const W=setInterval(()=>{n.loaded()&&n.isStyleLoaded()&&(clearInterval(W),F++,D())},250);setTimeout(()=>{E||(clearInterval(W),F++,D())},5e3)}catch(j){const O=j instanceof Error?j.message:"Unknown export map error";console.error(`[Export] Error initializing map ${I}:`,j),Fe("export_map_init_error",O),F++,D()}})};if(s==="national")G(p.current,"main",C||void 0,P),v.size>0&&G(x.current,"alaska",K||void 0,v),N.size>0&&G(R.current,"hawaii",X||void 0,N);else{const b=C||K||X,I=new Set(t.map(z=>z.zipCode));G(p.current,"main",b||void 0,I)}return()=>{Object.keys(g.current).forEach(b=>{g.current[b]?.remove(),g.current[b]=null})}},[s,r,a,t,v,N,P,K,X,C,f]),e.jsx("div",{className:"w-full h-full flex items-center justify-center overflow-hidden bg-muted/10 select-none",children:e.jsxs("div",{ref:d,style:{width:`${Ee}px`,height:`${ke}px`,transform:`scale(${h})`,boxShadow:"0 4px 20px rgba(0,0,0,0.15)",backgroundColor:"#ffffff"},className:"flex flex-col flex-shrink-0 origin-center rounded-md",onContextMenu:S=>(S.preventDefault(),!1),children:[e.jsxs("div",{className:"flex items-start justify-between px-8 pt-6 pb-4",children:[i&&e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold leading-tight text-gray-900",children:[pr(a)," by ZIP Code"]}),e.jsxs("p",{className:"text-base mt-1 text-gray-500",children:[r," • ",hr()]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 whitespace-nowrap flex-shrink-0 ml-auto mt-1",children:[e.jsxs("span",{children:["Built by ",e.jsx("a",{href:"https://jasperc2024.github.io/Domapus/",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-600 hover:underline",children:"Domapus"})]}),e.jsx("span",{className:"opacity-60",children:"•"}),e.jsxs("span",{children:["Data: ",e.jsx("a",{href:"https://www.redfin.com/news/data-center/",target:"_blank",rel:"noopener noreferrer",className:"hover:underline",style:{color:"#0c82a5"},children:"Redfin"})," & ",e.jsx("a",{href:"https://www.zillow.com/research/data/",target:"_blank",rel:"noopener noreferrer",className:"hover:underline",style:{color:"#0c82a5"},children:"Zillow"})]})]})]}),e.jsxs("div",{className:"flex-1 mx-8 mb-6 relative bg-slate-50",children:[e.jsx("div",{ref:p,className:"absolute inset-0"}),s==="national"&&e.jsxs("div",{className:"absolute bottom-4 left-4 flex gap-4 z-10",children:[v.size>0&&e.jsxs("div",{className:"flex flex-col bg-white border border-gray-200",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wider font-semibold py-0.5 px-2 bg-slate-50 text-slate-500 border-b",children:"Alaska"}),e.jsx("div",{className:"w-48 h-32 relative",children:e.jsx("div",{ref:x,className:"absolute inset-0"})})]}),N.size>0&&e.jsxs("div",{className:"flex flex-col bg-white border border-gray-200",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wider font-semibold py-0.5 px-2 bg-slate-50 text-slate-500 border-b",children:"Hawaii"}),e.jsx("div",{className:"w-48 h-32 relative",children:e.jsx("div",{ref:R,className:"absolute inset-0"})})]})]}),l&&e.jsxs("div",{className:"absolute bottom-4 right-4 z-10 p-4 bg-white/95 backdrop-blur rounded-md",children:[e.jsx("div",{className:"h-4 w-56",style:{background:`linear-gradient(to right, ${le.join(", ")})`,borderRadius:"4px"}}),e.jsxs("div",{className:"mt-2 flex justify-between text-xs font-semibold w-56 text-gray-600",children:[e.jsx("span",{children:U.min}),e.jsx("span",{children:U.mid}),e.jsx("span",{children:U.max})]})]}),!y&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/90 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-slate-200 border-t-cyan-600"}),e.jsx("span",{className:"text-sm font-medium text-slate-500",children:"Rendering map..."})]})})]})]})})});st.displayName="PrintStage";const Ie={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District of Columbia",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"};function Nr({allZipData:t,selectedMetric:a,onClose:s}){const[r,l]=o.useState("national"),[i,f]=o.useState(""),[u,c]=o.useState(""),[d,p]=o.useState(""),[x,R]=o.useState(""),[g,y]=o.useState(!1),k=o.useRef(null),[h,M]=o.useState("png"),[T,v]=o.useState(!0),[N,P]=o.useState(!0),[K,X]=o.useState(!1),[C,Q]=o.useState(!1),[V,U]=o.useState(!1),S=o.useRef(null);o.useEffect(()=>{const n=setTimeout(()=>R(d),150);return()=>clearTimeout(n)},[d]),o.useEffect(()=>{function n(j){k.current&&!k.current.contains(j.target)&&y(!1)}return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]),o.useEffect(()=>{U(!1)},[r,i,u,a,K]);const{availableStates:_,filteredMetros:F}=o.useMemo(()=>{if(Object.keys(t).length===0)return{availableStates:[],filteredMetros:[]};const n=new Set,j=new Set;for(const m of Object.values(t)){const w=m[a];w!=null&&(m.state&&n.add(m.state),m.metro&&j.add(m.metro))}const O=Array.from(n).map(m=>({code:m,name:Ie[m]||m})).sort((m,w)=>m.name.localeCompare(w.name)),L=Array.from(j);let W=L;if(x){const m=x.toLowerCase();W=L.filter(w=>w.toLowerCase().includes(m)),W.sort((w,B)=>{const J=w.toLowerCase(),se=B.toLowerCase(),H=J.indexOf(m),q=se.indexOf(m);return H!==q?H-q:w.localeCompare(B)})}else W.sort((m,w)=>m.localeCompare(w));return{availableStates:O,filteredMetros:W}},[t,a,x]),A=o.useMemo(()=>!!(r==="national"||r==="state"&&i||r==="metro"&&u),[r,i,u]),E=o.useMemo(()=>A?Object.keys(t).length===0?[]:Object.values(t).filter(n=>r==="state"&&i?n.state===i:r==="metro"&&u?n.metro===u:!0):[],[t,r,i,u,A]),D=o.useMemo(()=>r==="state"?Ie[i]||i||"Select a state":r==="metro"?u||"Select a metro area":"United States",[r,i,u]),G=()=>!!(C||!V||!A||E.length===0),b=()=>{if(C)return"Exporting...";if(!A){if(r==="state")return"Select a state";if(r==="metro")return"Select a metro"}return!V&&E.length>0?"Rendering...":`Export ${h.toUpperCase()}`},I=o.useCallback(async()=>{const n=S.current?.getElement();if(n){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"map_export_click",export_settings:{format:h,metric:a,scope:r,region_name:D,include_legend:T,include_title:N}}),Q(!0);try{await new Promise(L=>requestAnimationFrame(L)),await new Promise(L=>setTimeout(L,500));const O=await It(n,{scale:5,useCORS:!0,backgroundColor:"#ffffff",logging:!1,allowTaint:!0});if(h==="png"){const L=document.createElement("a");L.download=`Domapus-${a}-${r}.png`,L.href=O.toDataURL("image/png",1),L.click()}else{const L=O.toDataURL("image/png",1),W={orientation:"l",unit:"mm",format:"a4"},m=new At(W);m.setProperties({title:`Domapus Export - ${a}`,subject:`Real Estate Data for ${D}`,creator:"Domapus (https://jasperc2024.github.io/Domapus/)"});const w=m.internal.pageSize.getWidth(),B=m.internal.pageSize.getHeight(),J=O.width/O.height,se=w/B;let H,q,oe,ne;J>se?(H=w,q=w/J,oe=0,ne=(B-q)/2):(q=B,H=B*J,oe=(w-H)/2,ne=0),m.addImage(L,"PNG",oe,ne,H,q);const ee=n.getBoundingClientRect();n.querySelectorAll("a").forEach(Ne=>{const ie=Ne.getBoundingClientRect(),at=(ie.left-ee.left)/ee.width,ot=(ie.top-ee.top)/ee.height,nt=ie.width/ee.width,it=ie.height/ee.height,lt=oe+at*H,ct=ne+ot*q,dt=nt*H,ut=it*q;m.link(lt,ct,dt,ut,{url:Ne.href})}),m.save(`Domapus-${a}-${r}.pdf`)}je({title:"Export Complete",description:"Your map has been downloaded.",duration:1e4})}catch(j){console.error("Export failed:",j),Fe("export_failed",j?.message||"Unknown export error"),je({title:"Export Failed",description:"Something went wrong.",variant:"destructive"})}finally{Q(!1)}}},[h,a,r,D,T,N]),z=n=>{c(n),p(n),y(!1)},$=()=>{c(""),p(""),R(""),y(!0)};return e.jsxs("div",{className:"fixed inset-0 bg-background z-50 flex",children:[e.jsxs("div",{className:"w-80 bg-background border-r h-full shadow-xl flex flex-col",children:[e.jsxs("div",{className:"p-4 space-y-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(Se,{className:"h-4 w-4 text-primary"}),e.jsx("h2",{className:"text-base font-semibold",children:"Export Settings"})]}),e.jsxs("div",{className:"p-3 rounded-md border bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Pt,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Region Scope"})]}),e.jsxs(be,{value:r,onValueChange:n=>l(n),className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"national",id:"r-national"}),e.jsx(Y,{htmlFor:"r-national",className:"text-sm",children:"National"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"state",id:"r-state"}),e.jsx(Y,{htmlFor:"r-state",className:"text-sm",children:"State"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"metro",id:"r-metro"}),e.jsx(Y,{htmlFor:"r-metro",className:"text-sm",children:"Metro Area"})]})]}),r==="state"&&e.jsxs(Nt,{value:i,onValueChange:f,children:[e.jsx(jt,{className:"h-9",children:e.jsx(St,{placeholder:"Select a state"})}),e.jsx(Rt,{children:_.map(n=>e.jsx(Ct,{value:n.code,children:n.name},n.code))})]}),r==="metro"&&e.jsxs("div",{className:"space-y-2 relative",ref:k,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Et,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(kt,{placeholder:"Type to search metros...",value:d,onChange:n=>{p(n.target.value),y(!0),u&&n.target.value!==u&&c("")},onFocus:n=>{y(!0);const j=n.currentTarget;setTimeout(()=>j.select(),0)},className:"pl-8 h-9 pr-8"}),d&&e.jsx("button",{onClick:$,className:"absolute right-2 top-2.5 text-muted-foreground hover:text-foreground",children:e.jsx(Mt,{className:"h-4 w-4"})})]}),g&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-popover text-popover-foreground border rounded-md shadow-md max-h-[250px] overflow-y-auto",children:F.length>0?e.jsx("div",{className:"p-1",children:F.map(n=>e.jsx("div",{onClick:()=>z(n),className:fe("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground",u===n&&"bg-accent text-accent-foreground font-medium"),children:n},n))}):e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"No metro areas found."})})]})]}),e.jsxs("div",{className:"p-3 rounded-md border bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ft,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"File Format"})]}),e.jsxs(be,{value:h,onValueChange:n=>M(n),className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"png",id:"r-png"}),e.jsx(Y,{htmlFor:"r-png",className:"text-sm",children:"PNG"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"pdf",id:"r-pdf"}),e.jsx(Y,{htmlFor:"r-pdf",className:"text-sm",children:"PDF"})]})]})]}),e.jsxs("div",{className:"p-3 rounded-md border bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Lt,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Customization"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"c-title",checked:N,onCheckedChange:n=>P(n===!0)}),e.jsx(Y,{htmlFor:"c-title",className:"text-sm",children:"Include Title"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"c-legend",checked:T,onCheckedChange:n=>v(n===!0)}),e.jsx(Y,{htmlFor:"c-legend",className:"text-sm",children:"Include Legend"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"c-cities",checked:K,onCheckedChange:n=>X(n===!0)}),e.jsx(Y,{htmlFor:"c-cities",className:"text-sm",children:"Show Cities"})]})]})]})]}),e.jsxs("div",{className:"p-4 space-y-2 border-t bg-background",children:[e.jsxs(Re,{id:"btn-map-export",onClick:I,disabled:G(),className:"w-full",size:"default",children:[(C||!V&&A&&E.length>0)&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),!C&&A&&E.length>0&&V&&e.jsx(Se,{className:"h-4 w-4 mr-2"}),b()]}),e.jsx(Re,{onClick:s,variant:"outline",className:"w-full",disabled:C,children:"Cancel"})]})]}),e.jsxs("div",{className:"flex-1 p-6 overflow-hidden flex flex-col bg-muted/30",children:[e.jsxs("div",{className:"mb-3 flex-shrink-0",children:[e.jsx("h3",{className:"text-base font-semibold text-foreground",children:"Preview"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:A?`${E.length.toLocaleString()} ZIP codes`:"Select a region to preview"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-0 w-full",children:A?e.jsx(st,{ref:S,filteredData:E,selectedMetric:a,regionScope:r,regionName:D,includeLegend:T,includeTitle:N,showCities:K,onReady:()=>U(!0)}):e.jsx("div",{className:"bg-white/50 border border-dashed rounded-lg w-full h-full flex items-center justify-center text-muted-foreground",children:r==="state"?"Select a state to preview":"Select a metro area to preview"})})]})]})}export{Nr as ExportSidebar};
