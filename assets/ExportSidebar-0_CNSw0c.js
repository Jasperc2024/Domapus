import{c as pe,a as he,b as Rt,j as e,u as St,P as J,d as U,e as ne,f as Te,g as Ne,h as Et,i as De,k as Oe,l as Be,m as oe,n as It,o as _t,C as Mt,p as Pt,q as At,t as Ge,r as Ee,D as Ie,S as Ft,s as Lt,v as Tt,w as Dt,x as Ot,y as Bt,I as Gt,X as zt,B as _e}from"./index-BC1od6nH.js";import{b as n}from"./charts-AC_n-Gm3.js";import{h as Vt,E as Ht}from"./pdf-export-C9FlfLes.js";import"./maplibre-DtjTm36r.js";const Ut=pe("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const $t=pe("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);const Kt=pe("Microscope",[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]]);const qt=pe("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);var ge="rovingFocusGroup.onEntryFocus",Wt={bubbles:!1,cancelable:!0},ie="RovingFocusGroup",[we,ze,Yt]=Rt(ie),[Zt,Ve]=he(ie,[Yt]),[Xt,Jt]=Zt(ie),He=n.forwardRef((t,o)=>e.jsx(we.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(we.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Qt,{...t,ref:o})})}));He.displayName=ie;var Qt=n.forwardRef((t,o)=>{const{__scopeRovingFocusGroup:r,orientation:s,loop:c=!1,dir:a,currentTabStopId:f,defaultCurrentTabStopId:u,onCurrentTabStopIdChange:l,onEntryFocus:d,preventScrollOnEntryFocus:p=!1,...m}=t,w=n.useRef(null),x=ne(o,w),b=Te(a),[j,h]=Ne({prop:f,defaultProp:u??null,onChange:l,caller:ie}),[g,k]=n.useState(!1),v=Et(d),C=ze(r),P=n.useRef(!1),[G,$]=n.useState(0);return n.useEffect(()=>{const I=w.current;if(I)return I.addEventListener(ge,v),()=>I.removeEventListener(ge,v)},[v]),e.jsx(Xt,{scope:r,orientation:s,dir:b,loop:c,currentTabStopId:j,onItemFocus:n.useCallback(I=>h(I),[h]),onItemShiftTab:n.useCallback(()=>k(!0),[]),onFocusableItemAdd:n.useCallback(()=>$(I=>I+1),[]),onFocusableItemRemove:n.useCallback(()=>$(I=>I-1),[]),children:e.jsx(J.div,{tabIndex:g||G===0?-1:0,"data-orientation":s,...m,ref:x,style:{outline:"none",...t.style},onMouseDown:U(t.onMouseDown,()=>{P.current=!0}),onFocus:U(t.onFocus,I=>{const te=!P.current;if(I.target===I.currentTarget&&te&&!g){const z=new CustomEvent(ge,Wt);if(I.currentTarget.dispatchEvent(z),!z.defaultPrevented){const K=C().filter(_=>_.focusable),S=K.find(_=>_.active),F=K.find(_=>_.id===j),A=[S,F,...K].filter(Boolean).map(_=>_.ref.current);Ke(A,p)}}P.current=!1}),onBlur:U(t.onBlur,()=>k(!1))})})}),Ue="RovingFocusGroupItem",$e=n.forwardRef((t,o)=>{const{__scopeRovingFocusGroup:r,focusable:s=!0,active:c=!1,tabStopId:a,children:f,...u}=t,l=St(),d=a||l,p=Jt(Ue,r),m=p.currentTabStopId===d,w=ze(r),{onFocusableItemAdd:x,onFocusableItemRemove:b,currentTabStopId:j}=p;return n.useEffect(()=>{if(s)return x(),()=>b()},[s,x,b]),e.jsx(we.ItemSlot,{scope:r,id:d,focusable:s,active:c,children:e.jsx(J.span,{tabIndex:m?0:-1,"data-orientation":p.orientation,...u,ref:o,onMouseDown:U(t.onMouseDown,h=>{s?p.onItemFocus(d):h.preventDefault()}),onFocus:U(t.onFocus,()=>p.onItemFocus(d)),onKeyDown:U(t.onKeyDown,h=>{if(h.key==="Tab"&&h.shiftKey){p.onItemShiftTab();return}if(h.target!==h.currentTarget)return;const g=rr(h,p.orientation,p.dir);if(g!==void 0){if(h.metaKey||h.ctrlKey||h.altKey||h.shiftKey)return;h.preventDefault();let v=w().filter(C=>C.focusable).map(C=>C.ref.current);if(g==="last")v.reverse();else if(g==="prev"||g==="next"){g==="prev"&&v.reverse();const C=v.indexOf(h.currentTarget);v=p.loop?sr(v,C+1):v.slice(C+1)}setTimeout(()=>Ke(v))}}),children:typeof f=="function"?f({isCurrentTabStop:m,hasTabStop:j!=null}):f})})});$e.displayName=Ue;var er={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function tr(t,o){return o!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function rr(t,o,r){const s=tr(t.key,r);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return er[s]}function Ke(t,o=!1){const r=document.activeElement;for(const s of t)if(s===r||(s.focus({preventScroll:o}),document.activeElement!==r))return}function sr(t,o){return t.map((r,s)=>t[(o+s)%t.length])}var or=He,nr=$e,je="Radio",[ar,qe]=he(je),[ir,cr]=ar(je),We=n.forwardRef((t,o)=>{const{__scopeRadio:r,name:s,checked:c=!1,required:a,disabled:f,value:u="on",onCheck:l,form:d,...p}=t,[m,w]=n.useState(null),x=ne(o,h=>w(h)),b=n.useRef(!1),j=m?d||!!m.closest("form"):!0;return e.jsxs(ir,{scope:r,checked:c,disabled:f,children:[e.jsx(J.button,{type:"button",role:"radio","aria-checked":c,"data-state":Je(c),"data-disabled":f?"":void 0,disabled:f,value:u,...p,ref:x,onClick:U(t.onClick,h=>{c||l?.(),j&&(b.current=h.isPropagationStopped(),b.current||h.stopPropagation())})}),j&&e.jsx(Xe,{control:m,bubbles:!b.current,name:s,value:u,checked:c,required:a,disabled:f,form:d,style:{transform:"translateX(-100%)"}})]})});We.displayName=je;var Ye="RadioIndicator",Ze=n.forwardRef((t,o)=>{const{__scopeRadio:r,forceMount:s,...c}=t,a=cr(Ye,r);return e.jsx(De,{present:s||a.checked,children:e.jsx(J.span,{"data-state":Je(a.checked),"data-disabled":a.disabled?"":void 0,...c,ref:o})})});Ze.displayName=Ye;var lr="RadioBubbleInput",Xe=n.forwardRef(({__scopeRadio:t,control:o,checked:r,bubbles:s=!0,...c},a)=>{const f=n.useRef(null),u=ne(f,a),l=Oe(r),d=Be(o);return n.useEffect(()=>{const p=f.current;if(!p)return;const m=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(m,"checked").set;if(l!==r&&x){const b=new Event("click",{bubbles:s});x.call(p,r),p.dispatchEvent(b)}},[l,r,s]),e.jsx(J.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...c,tabIndex:-1,ref:u,style:{...c.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Xe.displayName=lr;function Je(t){return t?"checked":"unchecked"}var dr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],xe="RadioGroup",[ur]=he(xe,[Ve,qe]),Qe=Ve(),et=qe(),[fr,mr]=ur(xe),tt=n.forwardRef((t,o)=>{const{__scopeRadioGroup:r,name:s,defaultValue:c,value:a,required:f=!1,disabled:u=!1,orientation:l,dir:d,loop:p=!0,onValueChange:m,...w}=t,x=Qe(r),b=Te(d),[j,h]=Ne({prop:a,defaultProp:c??null,onChange:m,caller:xe});return e.jsx(fr,{scope:r,name:s,required:f,disabled:u,value:j,onValueChange:h,children:e.jsx(or,{asChild:!0,...x,orientation:l,dir:b,loop:p,children:e.jsx(J.div,{role:"radiogroup","aria-required":f,"aria-orientation":l,"data-disabled":u?"":void 0,dir:b,...w,ref:o})})})});tt.displayName=xe;var rt="RadioGroupItem",st=n.forwardRef((t,o)=>{const{__scopeRadioGroup:r,disabled:s,...c}=t,a=mr(rt,r),f=a.disabled||s,u=Qe(r),l=et(r),d=n.useRef(null),p=ne(o,d),m=a.value===c.value,w=n.useRef(!1);return n.useEffect(()=>{const x=j=>{dr.includes(j.key)&&(w.current=!0)},b=()=>w.current=!1;return document.addEventListener("keydown",x),document.addEventListener("keyup",b),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",b)}},[]),e.jsx(nr,{asChild:!0,...u,focusable:!f,active:m,children:e.jsx(We,{disabled:f,required:a.required,checked:m,...l,...c,name:a.name,ref:p,onCheck:()=>a.onValueChange(c.value),onKeyDown:U(x=>{x.key==="Enter"&&x.preventDefault()}),onFocus:U(c.onFocus,()=>{w.current&&d.current?.click()})})})});st.displayName=rt;var pr="RadioGroupIndicator",ot=n.forwardRef((t,o)=>{const{__scopeRadioGroup:r,...s}=t,c=et(r);return e.jsx(Ze,{...c,...s,ref:o})});ot.displayName=pr;var nt=tt,at=st,hr=ot;const Ce=n.forwardRef(({className:t,...o},r)=>e.jsx(nt,{className:oe("grid gap-2",t),...o,ref:r}));Ce.displayName=nt.displayName;const se=n.forwardRef(({className:t,...o},r)=>e.jsx(at,{ref:r,className:oe("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...o,children:e.jsx(hr,{className:"flex items-center justify-center",children:e.jsx(Ut,{className:"h-2.5 w-2.5 fill-current text-current"})})}));se.displayName=at.displayName;var xr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],br=xr.reduce((t,o)=>{const r=It(`Primitive.${o}`),s=n.forwardRef((c,a)=>{const{asChild:f,...u}=c,l=f?r:o;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(l,{...u,ref:a})});return s.displayName=`Primitive.${o}`,{...t,[o]:s}},{}),gr="Label",it=n.forwardRef((t,o)=>e.jsx(br.label,{...t,ref:o,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(t.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));it.displayName=gr;var ct=it;const vr=_t("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),X=n.forwardRef(({className:t,...o},r)=>e.jsx(ct,{ref:r,className:oe(vr(),t),...o}));X.displayName=ct.displayName;var be="Checkbox",[yr]=he(be),[wr,ke]=yr(be);function Cr(t){const{__scopeCheckbox:o,checked:r,children:s,defaultChecked:c,disabled:a,form:f,name:u,onCheckedChange:l,required:d,value:p="on",internal_do_not_use_render:m}=t,[w,x]=Ne({prop:r,defaultProp:c??!1,onChange:l,caller:be}),[b,j]=n.useState(null),[h,g]=n.useState(null),k=n.useRef(!1),v=b?!!f||!!b.closest("form"):!0,C={checked:w,disabled:a,setChecked:x,control:b,setControl:j,name:u,form:f,value:p,hasConsumerStoppedPropagationRef:k,required:d,defaultChecked:Q(c)?!1:c,isFormControl:v,bubbleInput:h,setBubbleInput:g};return e.jsx(wr,{scope:o,...C,children:Nr(m)?m(C):s})}var lt="CheckboxTrigger",dt=n.forwardRef(({__scopeCheckbox:t,onKeyDown:o,onClick:r,...s},c)=>{const{control:a,value:f,disabled:u,checked:l,required:d,setControl:p,setChecked:m,hasConsumerStoppedPropagationRef:w,isFormControl:x,bubbleInput:b}=ke(lt,t),j=ne(c,p),h=n.useRef(l);return n.useEffect(()=>{const g=a?.form;if(g){const k=()=>m(h.current);return g.addEventListener("reset",k),()=>g.removeEventListener("reset",k)}},[a,m]),e.jsx(J.button,{type:"button",role:"checkbox","aria-checked":Q(l)?"mixed":l,"aria-required":d,"data-state":ht(l),"data-disabled":u?"":void 0,disabled:u,value:f,...s,ref:j,onKeyDown:U(o,g=>{g.key==="Enter"&&g.preventDefault()}),onClick:U(r,g=>{m(k=>Q(k)?!0:!k),b&&x&&(w.current=g.isPropagationStopped(),w.current||g.stopPropagation())})})});dt.displayName=lt;var Re=n.forwardRef((t,o)=>{const{__scopeCheckbox:r,name:s,checked:c,defaultChecked:a,required:f,disabled:u,value:l,onCheckedChange:d,form:p,...m}=t;return e.jsx(Cr,{__scopeCheckbox:r,checked:c,defaultChecked:a,disabled:u,required:f,onCheckedChange:d,name:s,form:p,value:l,internal_do_not_use_render:({isFormControl:w})=>e.jsxs(e.Fragment,{children:[e.jsx(dt,{...m,ref:o,__scopeCheckbox:r}),w&&e.jsx(pt,{__scopeCheckbox:r})]})})});Re.displayName=be;var ut="CheckboxIndicator",ft=n.forwardRef((t,o)=>{const{__scopeCheckbox:r,forceMount:s,...c}=t,a=ke(ut,r);return e.jsx(De,{present:s||Q(a.checked)||a.checked===!0,children:e.jsx(J.span,{"data-state":ht(a.checked),"data-disabled":a.disabled?"":void 0,...c,ref:o,style:{pointerEvents:"none",...t.style}})})});ft.displayName=ut;var mt="CheckboxBubbleInput",pt=n.forwardRef(({__scopeCheckbox:t,...o},r)=>{const{control:s,hasConsumerStoppedPropagationRef:c,checked:a,defaultChecked:f,required:u,disabled:l,name:d,value:p,form:m,bubbleInput:w,setBubbleInput:x}=ke(mt,t),b=ne(r,x),j=Oe(a),h=Be(s);n.useEffect(()=>{const k=w;if(!k)return;const v=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(v,"checked").set,G=!c.current;if(j!==a&&P){const $=new Event("click",{bubbles:G});k.indeterminate=Q(a),P.call(k,Q(a)?!1:a),k.dispatchEvent($)}},[w,j,a,c]);const g=n.useRef(Q(a)?!1:a);return e.jsx(J.input,{type:"checkbox","aria-hidden":!0,defaultChecked:f??g.current,required:u,disabled:l,name:d,value:p,form:m,...o,tabIndex:-1,ref:b,style:{...o.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});pt.displayName=mt;function Nr(t){return typeof t=="function"}function Q(t){return t==="indeterminate"}function ht(t){return Q(t)?"indeterminate":t?"checked":"unchecked"}const me=n.forwardRef(({className:t,...o},r)=>e.jsx(Re,{ref:r,className:oe("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...o,children:e.jsx(ft,{className:oe("flex items-center justify-center text-current"),children:e.jsx(Mt,{className:"h-4 w-4"})})}));me.displayName=Re.displayName;function jr(t,o,r={}){const s={type:"Feature"};return(r.id===0||r.id)&&(s.id=r.id),r.bbox&&(s.bbox=r.bbox),s.properties={},s.geometry=t,s}function ve(t,o,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Me(t[0])||!Me(t[1]))throw new Error("coordinates must contain numbers");return jr({type:"Point",coordinates:t},o,r)}function kr(t,o={}){const r={type:"FeatureCollection"};return o.id&&(r.id=o.id),o.bbox&&(r.bbox=o.bbox),r.features=t,r}function Me(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function xt(t,o,r){if(t!==null)for(var s,c,a,f,u,l,d,p=0,m=0,w,x=t.type,b=x==="FeatureCollection",j=x==="Feature",h=b?t.features.length:1,g=0;g<h;g++){d=b?t.features[g].geometry:j?t.geometry:t,w=d?d.type==="GeometryCollection":!1,u=w?d.geometries.length:1;for(var k=0;k<u;k++){var v=0,C=0;if(f=w?d.geometries[k]:d,f!==null){l=f.coordinates;var P=f.type;switch(p=0,P){case null:break;case"Point":if(o(l,m,g,v,C)===!1)return!1;m++,v++;break;case"LineString":case"MultiPoint":for(s=0;s<l.length;s++){if(o(l[s],m,g,v,C)===!1)return!1;m++,P==="MultiPoint"&&v++}P==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(s=0;s<l.length;s++){for(c=0;c<l[s].length-p;c++){if(o(l[s][c],m,g,v,C)===!1)return!1;m++}P==="MultiLineString"&&v++,P==="Polygon"&&C++}P==="Polygon"&&v++;break;case"MultiPolygon":for(s=0;s<l.length;s++){for(C=0,c=0;c<l[s].length;c++){for(a=0;a<l[s][c].length-p;a++){if(o(l[s][c][a],m,g,v,C)===!1)return!1;m++}C++}v++}break;case"GeometryCollection":for(s=0;s<f.geometries.length;s++)if(xt(f.geometries[s],o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Rr(t,o={}){if(t.bbox!=null&&o.recompute!==!0)return t.bbox;const r=[1/0,1/0,-1/0,-1/0];return xt(t,s=>{r[0]>s[0]&&(r[0]=s[0]),r[1]>s[1]&&(r[1]=s[1]),r[2]<s[0]&&(r[2]=s[0]),r[3]<s[1]&&(r[3]=s[1])}),r}var Sr=Rr;const Er="/Domapus/",ue=["#FFF9B0","#FFEB84","#FFD166","#FF9A56","#E84C61","#C13584","#7B2E8D","#2E0B59"],Pe=1200,Ae=900,fe=.15;function Fe(t,o){if(!t)return 0;const r=t[o];return typeof r=="number"&&isFinite(r)?r:0}function Ir(t,o=8){const r=[...t].filter(l=>l>0).sort((l,d)=>l-d);if(r.length===0)return[];const s=r[0],c=r[r.length-1],a=[],f=(c-s)*1e-6||1e-6,u=l=>r[Math.floor(l*(r.length-1))];for(let l=1;l<o;l++){let d=u(l/o);a.length&&d<=a[a.length-1]&&(d=a[a.length-1]+f),a.push(d)}return a}const _r=t=>({zhvi:"Zillow Home Value Index",median_sale_price:"Median Sale Price",median_ppsf:"Median Price per Sq Ft",avg_sale_to_list_ratio:"Sale-to-List Ratio",median_dom:"Median Days on Market"})[t]||t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" "),Mr=()=>new Date(new Date().setMonth(new Date().getMonth()-1)).toLocaleDateString("en-US",{month:"long",year:"numeric"});function ye(t,o){const r=o.toLowerCase();return r.includes("price")||r.includes("zhvi")?`$${(t/1e3).toFixed(0)}k`:r.includes("ratio")?`${t.toFixed(1)}%`:t.toLocaleString()}function Pr(t,o){if(!t||t.length===0)return o.map(()=>0);const r=[...t].sort((s,c)=>s-c);return o.map(s=>{const c=(r.length-1)*s,a=Math.floor(c),f=Math.ceil(c),u=c-a;return r[a]*(1-u)+r[f]*u})}const bt=n.forwardRef(({filteredData:t,selectedMetric:o,regionScope:r,regionName:s,includeLegend:c,includeTitle:a,showCities:f=!1,onReady:u},l)=>{const d=n.useRef(null),p=n.useRef(null),m=n.useRef(null),w=n.useRef(null),x=n.useRef({}),[b,j]=n.useState(!1),[h,g]=n.useState(1);n.useEffect(()=>{const S=()=>{if(d.current&&d.current.parentElement){const L=d.current.parentElement,A=L.clientWidth,_=L.clientHeight,D=A/Pe,B=_/Ae,N=Math.min(D,B);g(N),Object.values(x.current).forEach(M=>M?.resize())}};S();const F=new ResizeObserver(S);return d.current?.parentElement&&F.observe(d.current.parentElement),()=>F.disconnect()},[]);const k=n.useMemo(()=>{const S={};return t.forEach(F=>{S[F.zipCode]=F}),S},[t]),{alaskaZips:v,hawaiiZips:C,mainlandZips:P,alaskaBounds:G,hawaiiBounds:$,mainlandBounds:I}=n.useMemo(()=>{const S=new Set,F=new Set,L=new Set,A=[],_=[],D=[];t.forEach(N=>{const M=(N.state??"").toString().toLowerCase(),V=M==="ak"||M==="alaska",q=M==="hi"||M==="hawaii",i=N.latitude||N.lat,E=N.longitude||N.lng;!i||!E||(V?(S.add(N.zipCode),A.push(ve([E,i]))):q?(F.add(N.zipCode),_.push(ve([E,i]))):(L.add(N.zipCode),D.push(ve([E,i]))))});const B=N=>{if(N.length===0)return null;const M=Sr(kr(N));let[V,q,i,E]=M;return V-=fe,q-=fe,i+=fe,E+=fe,[[V,q],[i,E]]};return{alaskaZips:S,hawaiiZips:F,mainlandZips:L,alaskaBounds:B(A),hawaiiBounds:B(_),mainlandBounds:B(D)}},[t]),te=n.useMemo(()=>Ir(t.map(S=>Fe(S,o))),[t,o]),z=n.useMemo(()=>t.map(S=>S[o]).filter(S=>typeof S=="number"&&S>0),[t,o]),K=n.useMemo(()=>{if(z.length===0)return{min:"N/A",mid:"N/A",max:"N/A"};const[S,F,L]=Pr(z,[.05,.5,.95]);return{min:ye(S,o),mid:ye(F,o),max:ye(L,o)}},[z,o]);return n.useImperativeHandle(l,()=>({getElement:()=>d.current})),n.useEffect(()=>{if(Pt(),j(!1),Object.keys(x.current).forEach(N=>{x.current[N]?.remove(),x.current[N]=null}),t.length===0){u?.();return}const S=new URL(`${Er}data/us_zip_codes.pmtiles`,window.location.origin).href,F=["step",["coalesce",["feature-state","metricValue"],0],"#efefef",1e-6,ue[0],...te.flatMap((N,M)=>[N,ue[Math.min(M+1,ue.length-1)]])];let L=0;const A=r==="national"?1+(v.size>0?1:0)+(C.size>0?1:0):1;let _=!1;const D=()=>{L>=A&&!_&&(_=!0,j(!0),u?.())},B=(N,M,V,q)=>{if(!N)return;const i=new At.Map({container:N,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",pixelRatio:2,interactive:!1,attributionControl:!1,fadeDuration:0,renderWorldCopies:!0});x.current[M]=i,i.on("load",()=>{try{if(i.resize(),V){const y=M==="alaska"||M==="hawaii"?5:40;i.fitBounds(V,{padding:y,animate:!1,maxZoom:M==="main"?12:6})}const E=i.getStyle();let O;E&&E.layers&&E.layers.forEach(y=>{const R=y.id,W=y["source-layer"],ee=R.includes("place_city"),ae=W==="water",H=R.includes("boundary_country")||R.includes("boundary_state");ee?(O||(O=R),i.setLayoutProperty(R,"visibility",f?"visible":"none")):ae||H?i.setLayoutProperty(R,"visibility","visible"):i.setLayoutProperty(R,"visibility","none")}),i.addSource("zips",{type:"vector",url:`pmtiles://${S}`,promoteId:"ZCTA5CE20"});const T=q?["in",["get","ZCTA5CE20"],["literal",Array.from(q)]]:["has","ZCTA5CE20"];i.addLayer({id:"zips-fill",type:"fill",source:"zips","source-layer":"us_zip_codes",filter:T,paint:{"fill-color":F,"fill-opacity":.9}},O),i.addLayer({id:"zips-border",type:"line",source:"zips","source-layer":"us_zip_codes",filter:T,paint:{"line-color":"rgba(0,0,0,0.1)","line-width":.5}},O),(q||new Set(t.map(y=>y.zipCode))).forEach(y=>{const R=k[y];R&&i.setFeatureState({source:"zips",sourceLayer:"us_zip_codes",id:y},{metricValue:Fe(R,o)})}),i.triggerRepaint();const Y=setInterval(()=>{i.loaded()&&i.isStyleLoaded()&&(clearInterval(Y),L++,D())},250);setTimeout(()=>{_||(clearInterval(Y),L++,D())},5e3)}catch(E){const O=E instanceof Error?E.message:"Unknown export map error";console.error(`[Export] Error initializing map ${M}:`,E),Ge("export_map_init_error",O),L++,D()}})};if(r==="national")B(p.current,"main",I||void 0,P),v.size>0&&B(m.current,"alaska",G||void 0,v),C.size>0&&B(w.current,"hawaii",$||void 0,C);else{const N=I||G||$,M=new Set(t.map(V=>V.zipCode));B(p.current,"main",N||void 0,M)}return()=>{Object.keys(x.current).forEach(N=>{x.current[N]?.remove(),x.current[N]=null})}},[r,s,o,t,v,C,P,G,$,I,f]),e.jsx("div",{className:"w-full h-full flex items-center justify-center overflow-hidden bg-muted/10 select-none",children:e.jsxs("div",{ref:d,style:{width:`${Pe}px`,height:`${Ae}px`,transform:`scale(${h})`,boxShadow:"0 4px 20px rgba(0,0,0,0.15)",backgroundColor:"#ffffff"},className:"flex flex-col flex-shrink-0 origin-center rounded-md",onContextMenu:S=>(S.preventDefault(),!1),children:[e.jsxs("div",{className:"flex items-start justify-between px-8 pt-6 pb-4",children:[a&&e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold leading-tight text-gray-900",children:[_r(o)," by ZIP Code"]}),e.jsxs("p",{className:"text-base mt-1 text-gray-500",children:[s," • ",Mr()]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 whitespace-nowrap flex-shrink-0 ml-auto mt-1",children:[e.jsxs("span",{children:["Built by ",e.jsx("a",{href:"https://jasperc2024.github.io/Domapus/",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-600 hover:underline",children:"Domapus"})]}),e.jsx("span",{className:"opacity-60",children:"•"}),e.jsxs("span",{children:["Data: ",e.jsx("a",{href:"https://www.redfin.com/news/data-center/",target:"_blank",rel:"noopener noreferrer",className:"hover:underline",style:{color:"#0c82a5"},children:"Redfin"})," & ",e.jsx("a",{href:"https://www.zillow.com/research/data/",target:"_blank",rel:"noopener noreferrer",className:"hover:underline",style:{color:"#0c82a5"},children:"Zillow"})]})]})]}),e.jsxs("div",{className:"flex-1 mx-8 mb-6 relative bg-slate-50",children:[e.jsx("div",{ref:p,className:"absolute inset-0"}),r==="national"&&e.jsxs("div",{className:"absolute bottom-4 left-4 flex gap-4 z-10",children:[v.size>0&&e.jsxs("div",{className:"flex flex-col bg-white border border-gray-200",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wider font-semibold py-0.5 px-2 bg-slate-50 text-slate-500 border-b",children:"Alaska"}),e.jsx("div",{className:"w-48 h-32 relative",children:e.jsx("div",{ref:m,className:"absolute inset-0"})})]}),C.size>0&&e.jsxs("div",{className:"flex flex-col bg-white border border-gray-200",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wider font-semibold py-0.5 px-2 bg-slate-50 text-slate-500 border-b",children:"Hawaii"}),e.jsx("div",{className:"w-48 h-32 relative",children:e.jsx("div",{ref:w,className:"absolute inset-0"})})]})]}),c&&e.jsxs("div",{className:"absolute bottom-4 right-4 z-10 p-4 bg-white/95 backdrop-blur rounded-md",children:[e.jsx("div",{className:"h-4 w-56",style:{background:`linear-gradient(to right, ${ue.join(", ")})`,borderRadius:"4px"}}),e.jsxs("div",{className:"mt-2 flex justify-between text-xs font-semibold w-56 text-gray-600",children:[e.jsx("span",{children:K.min}),e.jsx("span",{children:K.mid}),e.jsx("span",{children:K.max})]})]}),!b&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/90 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-slate-200 border-t-cyan-600"}),e.jsx("span",{className:"text-sm font-medium text-slate-500",children:"Rendering map..."})]})})]})]})})});bt.displayName="PrintStage";const Le={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District of Columbia",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"};function Or({allZipData:t,selectedMetric:o,onClose:r}){const[s,c]=n.useState("national"),[a,f]=n.useState(""),[u,l]=n.useState(""),[d,p]=n.useState(""),[m,w]=n.useState(""),[x,b]=n.useState(!1),j=n.useRef(null),[h,g]=n.useState("png"),[k,v]=n.useState(!0),[C,P]=n.useState(!0),[G,$]=n.useState(!1),[I,te]=n.useState(!1),[z,K]=n.useState(!1),S=n.useRef(null);n.useEffect(()=>{const i=setTimeout(()=>w(d),150);return()=>clearTimeout(i)},[d]),n.useEffect(()=>{function i(E){j.current&&!j.current.contains(E.target)&&b(!1)}return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]),n.useEffect(()=>{K(!1)},[s,a,u,o,G]);const{availableStates:F,filteredMetros:L}=n.useMemo(()=>{if(Object.keys(t).length===0)return{availableStates:[],filteredMetros:[]};const i=new Set,E=new Set;for(const y of Object.values(t)){const R=y[o];R!=null&&(y.state&&i.add(y.state),y.metro&&E.add(y.metro))}const O=Array.from(i).map(y=>({code:y,name:Le[y]||y})).sort((y,R)=>y.name.localeCompare(R.name)),T=Array.from(E);let Y=T;if(m){const y=m.toLowerCase();Y=T.filter(R=>R.toLowerCase().includes(y)),Y.sort((R,W)=>{const ee=R.toLowerCase(),ae=W.toLowerCase(),H=ee.indexOf(y),Z=ae.indexOf(y);return H!==Z?H-Z:R.localeCompare(W)})}else Y.sort((y,R)=>y.localeCompare(R));return{availableStates:O,filteredMetros:Y}},[t,o,m]),A=n.useMemo(()=>!!(s==="national"||s==="state"&&a||s==="metro"&&u),[s,a,u]),_=n.useMemo(()=>A?Object.keys(t).length===0?[]:Object.values(t).filter(i=>s==="state"&&a?i.state===a:s==="metro"&&u?i.metro===u:!0):[],[t,s,a,u,A]),D=n.useMemo(()=>s==="state"?Le[a]||a||"Select a state":s==="metro"?u||"Select a metro area":"United States",[s,a,u]),B=()=>!!(I||!z||!A||_.length===0),N=()=>{if(I)return"Exporting...";if(!A){if(s==="state")return"Select a state";if(s==="metro")return"Select a metro"}return!z&&_.length>0?"Rendering...":`Export ${h.toUpperCase()}`},M=n.useCallback(async()=>{const i=S.current?.getElement();if(i){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"map_export_click",export_settings:{format:h,metric:o,scope:s,region_name:D,include_legend:k,include_title:C}}),te(!0);try{await new Promise(T=>requestAnimationFrame(T)),await new Promise(T=>setTimeout(T,500));const O=await Vt(i,{scale:5,useCORS:!0,backgroundColor:"#ffffff",logging:!1,allowTaint:!0});if(h==="png"){const T=document.createElement("a");T.download=`Domapus-${o}-${s}.png`,T.href=O.toDataURL("image/png",1),T.click()}else{const T=O.toDataURL("image/png",1),Y={orientation:"l",unit:"mm",format:"a4"},y=new Ht(Y);y.setProperties({title:`Domapus Export - ${o}`,subject:`Real Estate Data for ${D}`,creator:"Domapus (https://jasperc2024.github.io/Domapus/)"});const R=y.internal.pageSize.getWidth(),W=y.internal.pageSize.getHeight(),ee=O.width/O.height,ae=R/W;let H,Z,ce,le;ee>ae?(H=R,Z=R/ee,ce=0,le=(W-Z)/2):(Z=W,H=W*ee,ce=(R-H)/2,le=0),y.addImage(T,"PNG",ce,le,H,Z);const re=i.getBoundingClientRect();i.querySelectorAll("a").forEach(Se=>{const de=Se.getBoundingClientRect(),gt=(de.left-re.left)/re.width,vt=(de.top-re.top)/re.height,yt=de.width/re.width,wt=de.height/re.height,Ct=ce+gt*H,Nt=le+vt*Z,jt=yt*H,kt=wt*Z;y.link(Ct,Nt,jt,kt,{url:Se.href})}),y.save(`Domapus-${o}-${s}.pdf`)}Ee({title:"Export Complete",description:"Your map has been downloaded.",duration:1e4})}catch(E){console.error("Export failed:",E),Ge("export_failed",E?.message||"Unknown export error"),Ee({title:"Export Failed",description:"Something went wrong.",variant:"destructive"})}finally{te(!1)}}},[h,o,s,D,k,C]),V=i=>{l(i),p(i),b(!1)},q=()=>{l(""),p(""),w(""),b(!0)};return e.jsxs("div",{className:"fixed inset-0 bg-background z-50 flex",children:[e.jsxs("div",{className:"w-80 bg-background border-r h-full shadow-xl flex flex-col",children:[e.jsxs("div",{className:"p-4 space-y-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(Ie,{className:"h-4 w-4 text-primary"}),e.jsx("h2",{className:"text-base font-semibold",children:"Export Settings"})]}),e.jsxs("div",{className:"p-3 rounded-md border bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Kt,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Region Scope"})]}),e.jsxs(Ce,{value:s,onValueChange:i=>c(i),className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:"national",id:"r-national"}),e.jsx(X,{htmlFor:"r-national",className:"text-sm",children:"National"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:"state",id:"r-state"}),e.jsx(X,{htmlFor:"r-state",className:"text-sm",children:"State"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:"metro",id:"r-metro"}),e.jsx(X,{htmlFor:"r-metro",className:"text-sm",children:"Metro Area"})]})]}),s==="state"&&e.jsxs(Ft,{value:a,onValueChange:f,children:[e.jsx(Lt,{className:"h-9",children:e.jsx(Tt,{placeholder:"Select a state"})}),e.jsx(Dt,{children:F.map(i=>e.jsx(Ot,{value:i.code,children:i.name},i.code))})]}),s==="metro"&&e.jsxs("div",{className:"space-y-2 relative",ref:j,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Bt,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Gt,{placeholder:"Type to search metros...",value:d,onChange:i=>{p(i.target.value),b(!0),u&&i.target.value!==u&&l("")},onFocus:i=>{b(!0);const E=i.currentTarget;setTimeout(()=>E.select(),0)},className:"pl-8 h-9 pr-8"}),d&&e.jsx("button",{onClick:q,className:"absolute right-2 top-2.5 text-muted-foreground hover:text-foreground",children:e.jsx(zt,{className:"h-4 w-4"})})]}),x&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-popover text-popover-foreground border rounded-md shadow-md max-h-[250px] overflow-y-auto",children:L.length>0?e.jsx("div",{className:"p-1",children:L.map(i=>e.jsx("div",{onClick:()=>V(i),className:oe("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground",u===i&&"bg-accent text-accent-foreground font-medium"),children:i},i))}):e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"No metro areas found."})})]})]}),e.jsxs("div",{className:"p-3 rounded-md border bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx($t,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"File Format"})]}),e.jsxs(Ce,{value:h,onValueChange:i=>g(i),className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:"png",id:"r-png"}),e.jsx(X,{htmlFor:"r-png",className:"text-sm",children:"PNG"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:"pdf",id:"r-pdf"}),e.jsx(X,{htmlFor:"r-pdf",className:"text-sm",children:"PDF"})]})]})]}),e.jsxs("div",{className:"p-3 rounded-md border bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(qt,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Customization"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{id:"c-title",checked:C,onCheckedChange:i=>P(i===!0)}),e.jsx(X,{htmlFor:"c-title",className:"text-sm",children:"Include Title"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{id:"c-legend",checked:k,onCheckedChange:i=>v(i===!0)}),e.jsx(X,{htmlFor:"c-legend",className:"text-sm",children:"Include Legend"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{id:"c-cities",checked:G,onCheckedChange:i=>$(i===!0)}),e.jsx(X,{htmlFor:"c-cities",className:"text-sm",children:"Show Cities"})]})]})]})]}),e.jsxs("div",{className:"p-4 space-y-2 border-t bg-background",children:[e.jsxs(_e,{id:"btn-map-export",onClick:M,disabled:B(),className:"w-full",size:"default",children:[(I||!z&&A&&_.length>0)&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),!I&&A&&_.length>0&&z&&e.jsx(Ie,{className:"h-4 w-4 mr-2"}),N()]}),e.jsx(_e,{onClick:r,variant:"outline",className:"w-full",disabled:I,children:"Cancel"})]})]}),e.jsxs("div",{className:"flex-1 p-6 overflow-hidden flex flex-col bg-muted/30",children:[e.jsxs("div",{className:"mb-3 flex-shrink-0",children:[e.jsx("h3",{className:"text-base font-semibold text-foreground",children:"Preview"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:A?`${_.length.toLocaleString()} ZIP codes`:"Select a region to preview"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-0 w-full",children:A?e.jsx(bt,{ref:S,filteredData:_,selectedMetric:o,regionScope:s,regionName:D,includeLegend:k,includeTitle:C,showCities:G,onReady:()=>K(!0)}):e.jsx("div",{className:"bg-white/50 border border-dashed rounded-lg w-full h-full flex items-center justify-center text-muted-foreground",children:s==="state"?"Select a state to preview":"Select a metro area to preview"})})]})]})}export{Or as ExportSidebar};
