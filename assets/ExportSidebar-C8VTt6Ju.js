import{c as de,a as we,b as ft,j as e,u as mt,P as re,d as Z,e as ue,f as Ie,g as Me,h as pt,i as ht,k as xt,l as gt,m as fe,n as vt,o as bt,p as wt,q as yt,t as Pe,r as Ne,s as Se,D as Re,S as jt,v as Nt,w as St,x as Rt,y as Ct,z as Et,I as kt,X as _t,C as pe,B as Ce}from"./index-C1VooJf0.js";import{b as o}from"./charts-AC_n-Gm3.js";import{h as Ft,E as It}from"./pdf-export-C9FlfLes.js";import"./maplibre-DtjTm36r.js";const Mt=de("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const Pt=de("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);const At=de("Microscope",[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]]);const Lt=de("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);var he="rovingFocusGroup.onEntryFocus",Tt={bubbles:!1,cancelable:!0},ae="RovingFocusGroup",[ve,Ae,Dt]=ft(ae),[Ot,Le]=we(ae,[Dt]),[Gt,zt]=Ot(ae),Te=o.forwardRef((t,a)=>e.jsx(ve.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(ve.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Bt,{...t,ref:a})})}));Te.displayName=ae;var Bt=o.forwardRef((t,a)=>{const{__scopeRovingFocusGroup:s,orientation:r,loop:c=!1,dir:i,currentTabStopId:f,defaultCurrentTabStopId:u,onCurrentTabStopIdChange:l,onEntryFocus:d,preventScrollOnEntryFocus:m=!1,...x}=t,R=o.useRef(null),g=ue(a,R),y=Ie(i),[k,p]=Me({prop:f,defaultProp:u??null,onChange:l,caller:ae}),[_,T]=o.useState(!1),v=pt(d),j=Ae(s),A=o.useRef(!1),[q,X]=o.useState(0);return o.useEffect(()=>{const C=R.current;if(C)return C.addEventListener(he,v),()=>C.removeEventListener(he,v)},[v]),e.jsx(Gt,{scope:s,orientation:r,dir:y,loop:c,currentTabStopId:k,onItemFocus:o.useCallback(C=>p(C),[p]),onItemShiftTab:o.useCallback(()=>T(!0),[]),onFocusableItemAdd:o.useCallback(()=>X(C=>C+1),[]),onFocusableItemRemove:o.useCallback(()=>X(C=>C-1),[]),children:e.jsx(re.div,{tabIndex:_||q===0?-1:0,"data-orientation":r,...x,ref:g,style:{outline:"none",...t.style},onMouseDown:Z(t.onMouseDown,()=>{A.current=!0}),onFocus:Z(t.onFocus,C=>{const J=!A.current;if(C.target===C.currentTarget&&J&&!_){const V=new CustomEvent(he,Tt);if(C.currentTarget.dispatchEvent(V),!V.defaultPrevented){const $=j().filter(E=>E.focusable),S=$.find(E=>E.active),I=$.find(E=>E.id===k),P=[S,I,...$].filter(Boolean).map(E=>E.ref.current);Ge(P,m)}}A.current=!1}),onBlur:Z(t.onBlur,()=>T(!1))})})}),De="RovingFocusGroupItem",Oe=o.forwardRef((t,a)=>{const{__scopeRovingFocusGroup:s,focusable:r=!0,active:c=!1,tabStopId:i,children:f,...u}=t,l=mt(),d=i||l,m=zt(De,s),x=m.currentTabStopId===d,R=Ae(s),{onFocusableItemAdd:g,onFocusableItemRemove:y,currentTabStopId:k}=m;return o.useEffect(()=>{if(r)return g(),()=>y()},[r,g,y]),e.jsx(ve.ItemSlot,{scope:s,id:d,focusable:r,active:c,children:e.jsx(re.span,{tabIndex:x?0:-1,"data-orientation":m.orientation,...u,ref:a,onMouseDown:Z(t.onMouseDown,p=>{r?m.onItemFocus(d):p.preventDefault()}),onFocus:Z(t.onFocus,()=>m.onItemFocus(d)),onKeyDown:Z(t.onKeyDown,p=>{if(p.key==="Tab"&&p.shiftKey){m.onItemShiftTab();return}if(p.target!==p.currentTarget)return;const _=$t(p,m.orientation,m.dir);if(_!==void 0){if(p.metaKey||p.ctrlKey||p.altKey||p.shiftKey)return;p.preventDefault();let v=R().filter(j=>j.focusable).map(j=>j.ref.current);if(_==="last")v.reverse();else if(_==="prev"||_==="next"){_==="prev"&&v.reverse();const j=v.indexOf(p.currentTarget);v=m.loop?Ht(v,j+1):v.slice(j+1)}setTimeout(()=>Ge(v))}}),children:typeof f=="function"?f({isCurrentTabStop:x,hasTabStop:k!=null}):f})})});Oe.displayName=De;var Vt={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ut(t,a){return a!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function $t(t,a,s){const r=Ut(t.key,s);if(!(a==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(a==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Vt[r]}function Ge(t,a=!1){const s=document.activeElement;for(const r of t)if(r===s||(r.focus({preventScroll:a}),document.activeElement!==s))return}function Ht(t,a){return t.map((s,r)=>t[(a+r)%t.length])}var qt=Te,Kt=Oe,ye="Radio",[Wt,ze]=we(ye),[Yt,Zt]=Wt(ye),Be=o.forwardRef((t,a)=>{const{__scopeRadio:s,name:r,checked:c=!1,required:i,disabled:f,value:u="on",onCheck:l,form:d,...m}=t,[x,R]=o.useState(null),g=ue(a,p=>R(p)),y=o.useRef(!1),k=x?d||!!x.closest("form"):!0;return e.jsxs(Yt,{scope:s,checked:c,disabled:f,children:[e.jsx(re.button,{type:"button",role:"radio","aria-checked":c,"data-state":He(c),"data-disabled":f?"":void 0,disabled:f,value:u,...m,ref:g,onClick:Z(t.onClick,p=>{c||l?.(),k&&(y.current=p.isPropagationStopped(),y.current||p.stopPropagation())})}),k&&e.jsx($e,{control:x,bubbles:!y.current,name:r,value:u,checked:c,required:i,disabled:f,form:d,style:{transform:"translateX(-100%)"}})]})});Be.displayName=ye;var Ve="RadioIndicator",Ue=o.forwardRef((t,a)=>{const{__scopeRadio:s,forceMount:r,...c}=t,i=Zt(Ve,s);return e.jsx(ht,{present:r||i.checked,children:e.jsx(re.span,{"data-state":He(i.checked),"data-disabled":i.disabled?"":void 0,...c,ref:a})})});Ue.displayName=Ve;var Xt="RadioBubbleInput",$e=o.forwardRef(({__scopeRadio:t,control:a,checked:s,bubbles:r=!0,...c},i)=>{const f=o.useRef(null),u=ue(f,i),l=xt(s),d=gt(a);return o.useEffect(()=>{const m=f.current;if(!m)return;const x=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(x,"checked").set;if(l!==s&&g){const y=new Event("click",{bubbles:r});g.call(m,s),m.dispatchEvent(y)}},[l,s,r]),e.jsx(re.input,{type:"radio","aria-hidden":!0,defaultChecked:s,...c,tabIndex:-1,ref:u,style:{...c.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});$e.displayName=Xt;function He(t){return t?"checked":"unchecked"}var Qt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],me="RadioGroup",[Jt]=we(me,[Le,ze]),qe=Le(),Ke=ze(),[er,tr]=Jt(me),We=o.forwardRef((t,a)=>{const{__scopeRadioGroup:s,name:r,defaultValue:c,value:i,required:f=!1,disabled:u=!1,orientation:l,dir:d,loop:m=!0,onValueChange:x,...R}=t,g=qe(s),y=Ie(d),[k,p]=Me({prop:i,defaultProp:c??null,onChange:x,caller:me});return e.jsx(er,{scope:s,name:r,required:f,disabled:u,value:k,onValueChange:p,children:e.jsx(qt,{asChild:!0,...g,orientation:l,dir:y,loop:m,children:e.jsx(re.div,{role:"radiogroup","aria-required":f,"aria-orientation":l,"data-disabled":u?"":void 0,dir:y,...R,ref:a})})})});We.displayName=me;var Ye="RadioGroupItem",Ze=o.forwardRef((t,a)=>{const{__scopeRadioGroup:s,disabled:r,...c}=t,i=tr(Ye,s),f=i.disabled||r,u=qe(s),l=Ke(s),d=o.useRef(null),m=ue(a,d),x=i.value===c.value,R=o.useRef(!1);return o.useEffect(()=>{const g=k=>{Qt.includes(k.key)&&(R.current=!0)},y=()=>R.current=!1;return document.addEventListener("keydown",g),document.addEventListener("keyup",y),()=>{document.removeEventListener("keydown",g),document.removeEventListener("keyup",y)}},[]),e.jsx(Kt,{asChild:!0,...u,focusable:!f,active:x,children:e.jsx(Be,{disabled:f,required:i.required,checked:x,...l,...c,name:i.name,ref:m,onCheck:()=>i.onValueChange(c.value),onKeyDown:Z(g=>{g.key==="Enter"&&g.preventDefault()}),onFocus:Z(c.onFocus,()=>{R.current&&d.current?.click()})})})});Ze.displayName=Ye;var rr="RadioGroupIndicator",Xe=o.forwardRef((t,a)=>{const{__scopeRadioGroup:s,...r}=t,c=Ke(s);return e.jsx(Ue,{...c,...r,ref:a})});Xe.displayName=rr;var Qe=We,Je=Ze,sr=Xe;const be=o.forwardRef(({className:t,...a},s)=>e.jsx(Qe,{className:fe("grid gap-2",t),...a,ref:s}));be.displayName=Qe.displayName;const te=o.forwardRef(({className:t,...a},s)=>e.jsx(Je,{ref:s,className:fe("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:e.jsx(sr,{className:"flex items-center justify-center",children:e.jsx(Mt,{className:"h-2.5 w-2.5 fill-current text-current"})})}));te.displayName=Je.displayName;var ar=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],or=ar.reduce((t,a)=>{const s=vt(`Primitive.${a}`),r=o.forwardRef((c,i)=>{const{asChild:f,...u}=c,l=f?s:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(l,{...u,ref:i})});return r.displayName=`Primitive.${a}`,{...t,[a]:r}},{}),nr="Label",et=o.forwardRef((t,a)=>e.jsx(or.label,{...t,ref:a,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(t.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));et.displayName=nr;var tt=et;const ir=bt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Y=o.forwardRef(({className:t,...a},s)=>e.jsx(tt,{ref:s,className:fe(ir(),t),...a}));Y.displayName=tt.displayName;function cr(t,a,s={}){const r={type:"Feature"};return(s.id===0||s.id)&&(r.id=s.id),s.bbox&&(r.bbox=s.bbox),r.properties={},r.geometry=t,r}function xe(t,a,s={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ee(t[0])||!Ee(t[1]))throw new Error("coordinates must contain numbers");return cr({type:"Point",coordinates:t},a,s)}function lr(t,a={}){const s={type:"FeatureCollection"};return a.id&&(s.id=a.id),a.bbox&&(s.bbox=a.bbox),s.features=t,s}function Ee(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function rt(t,a,s){if(t!==null)for(var r,c,i,f,u,l,d,m=0,x=0,R,g=t.type,y=g==="FeatureCollection",k=g==="Feature",p=y?t.features.length:1,_=0;_<p;_++){d=y?t.features[_].geometry:k?t.geometry:t,R=d?d.type==="GeometryCollection":!1,u=R?d.geometries.length:1;for(var T=0;T<u;T++){var v=0,j=0;if(f=R?d.geometries[T]:d,f!==null){l=f.coordinates;var A=f.type;switch(m=0,A){case null:break;case"Point":if(a(l,x,_,v,j)===!1)return!1;x++,v++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(a(l[r],x,_,v,j)===!1)return!1;x++,A==="MultiPoint"&&v++}A==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(c=0;c<l[r].length-m;c++){if(a(l[r][c],x,_,v,j)===!1)return!1;x++}A==="MultiLineString"&&v++,A==="Polygon"&&j++}A==="Polygon"&&v++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(j=0,c=0;c<l[r].length;c++){for(i=0;i<l[r][c].length-m;i++){if(a(l[r][c][i],x,_,v,j)===!1)return!1;x++}j++}v++}break;case"GeometryCollection":for(r=0;r<f.geometries.length;r++)if(rt(f.geometries[r],a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function dr(t,a={}){if(t.bbox!=null&&a.recompute!==!0)return t.bbox;const s=[1/0,1/0,-1/0,-1/0];return rt(t,r=>{s[0]>r[0]&&(s[0]=r[0]),s[1]>r[1]&&(s[1]=r[1]),s[2]<r[0]&&(s[2]=r[0]),s[3]<r[1]&&(s[3]=r[1])}),s}var ur=dr;const fr="/Domapus/",ce=["#FFF9B0","#FFEB84","#FFD166","#FF9A56","#E84C61","#C13584","#7B2E8D","#2E0B59"],ke=1200,_e=900,le=.15;function Fe(t,a){if(!t)return 0;const s=t[a];return typeof s=="number"&&isFinite(s)?s:0}function mr(t,a=8){const s=[...t].filter(l=>l>0).sort((l,d)=>l-d);if(s.length===0)return[];const r=s[0],c=s[s.length-1],i=[],f=(c-r)*1e-6||1e-6,u=l=>s[Math.floor(l*(s.length-1))];for(let l=1;l<a;l++){let d=u(l/a);i.length&&d<=i[i.length-1]&&(d=i[i.length-1]+f),i.push(d)}return i}const pr=t=>({zhvi:"Zillow Home Value Index",median_sale_price:"Median Sale Price",median_ppsf:"Median Price per Sq Ft",avg_sale_to_list_ratio:"Sale-to-List Ratio",median_dom:"Median Days on Market"})[t]||t.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),hr=()=>new Date(new Date().setMonth(new Date().getMonth()-1)).toLocaleDateString("en-US",{month:"long",year:"numeric"});function ge(t,a){const s=a.toLowerCase();return s.includes("price")||s.includes("zhvi")?`$${(t/1e3).toFixed(0)}k`:s.includes("ratio")?`${t.toFixed(1)}%`:t.toLocaleString()}function xr(t,a){if(!t||t.length===0)return a.map(()=>0);const s=[...t].sort((r,c)=>r-c);return a.map(r=>{const c=(s.length-1)*r,i=Math.floor(c),f=Math.ceil(c),u=c-i;return s[i]*(1-u)+s[f]*u})}const st=o.forwardRef(({filteredData:t,selectedMetric:a,regionScope:s,regionName:r,includeLegend:c,includeTitle:i,showCities:f=!1,onReady:u},l)=>{const d=o.useRef(null),m=o.useRef(null),x=o.useRef(null),R=o.useRef(null),g=o.useRef({}),[y,k]=o.useState(!1),[p,_]=o.useState(1);o.useEffect(()=>{const S=()=>{if(d.current&&d.current.parentElement){const M=d.current.parentElement,P=M.clientWidth,E=M.clientHeight,D=P/ke,G=E/_e,b=Math.min(D,G);_(b),Object.values(g.current).forEach(F=>F?.resize())}};S();const I=new ResizeObserver(S);return d.current?.parentElement&&I.observe(d.current.parentElement),()=>I.disconnect()},[]);const T=o.useMemo(()=>{const S={};return t.forEach(I=>{S[I.zipCode]=I}),S},[t]),{alaskaZips:v,hawaiiZips:j,mainlandZips:A,alaskaBounds:q,hawaiiBounds:X,mainlandBounds:C}=o.useMemo(()=>{const S=new Set,I=new Set,M=new Set,P=[],E=[],D=[];t.forEach(b=>{const F=(b.state??"").toString().toLowerCase(),z=F==="ak"||F==="alaska",H=F==="hi"||F==="hawaii",n=b.latitude||b.lat,N=b.longitude||b.lng;!n||!N||(z?(S.add(b.zipCode),N<0&&P.push(xe([N,n]))):H?(I.add(b.zipCode),E.push(xe([N,n]))):(M.add(b.zipCode),D.push(xe([N,n]))))});const G=b=>{if(b.length===0)return null;const F=ur(lr(b));let[z,H,n,N]=F;return z-=le,H-=le,n+=le,N+=le,[[z,H],[n,N]]};return{alaskaZips:S,hawaiiZips:I,mainlandZips:M,alaskaBounds:G(P),hawaiiBounds:G(E),mainlandBounds:G(D)}},[t]),J=o.useMemo(()=>mr(t.map(S=>Fe(S,a))),[t,a]),V=o.useMemo(()=>t.map(S=>S[a]).filter(S=>typeof S=="number"&&S>0),[t,a]),$=o.useMemo(()=>{if(V.length===0)return{min:"N/A",mid:"N/A",max:"N/A"};const[S,I,M]=xr(V,[.05,.5,.95]);return{min:ge(S,a),mid:ge(I,a),max:ge(M,a)}},[V,a]);return o.useImperativeHandle(l,()=>({getElement:()=>d.current})),o.useEffect(()=>{if(wt(),k(!1),Object.keys(g.current).forEach(b=>{g.current[b]?.remove(),g.current[b]=null}),t.length===0){u?.();return}const S=new URL(`${fr}data/us_zip_codes.pmtiles`,window.location.origin).href,I=["step",["coalesce",["feature-state","metricValue"],0],"#efefef",1e-6,ce[0],...J.flatMap((b,F)=>[b,ce[Math.min(F+1,ce.length-1)]])];let M=0;const P=s==="national"?1+(v.size>0?1:0)+(j.size>0?1:0):1;let E=!1;const D=()=>{M>=P&&!E&&(E=!0,k(!0),u?.())},G=(b,F,z,H)=>{if(!b)return;const n=new yt.Map({container:b,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",pixelRatio:2,interactive:!1,attributionControl:!1,fadeDuration:0,renderWorldCopies:!0});g.current[F]=n,n.on("load",()=>{try{if(n.resize(),z){const h=F==="alaska"||F==="hawaii"?20:40;z.flat().every(B=>Number.isFinite(B))&&n.fitBounds(z,{padding:h,animate:!1,maxZoom:F==="main"?12:6})}const N=n.getStyle();let O;N&&N.layers&&N.layers.forEach(h=>{const w=h.id,B=h["source-layer"],Q=w.includes("place_city"),se=B==="water",U=w.includes("boundary_country")||w.includes("boundary_state");Q?(O||(O=w),n.setLayoutProperty(w,"visibility",f?"visible":"none")):se||U?n.setLayoutProperty(w,"visibility","visible"):n.setLayoutProperty(w,"visibility","none")}),n.addSource("zips",{type:"vector",url:`pmtiles://${S}`,promoteId:"ZCTA5CE20"});const L=H?["in",["get","ZCTA5CE20"],["literal",Array.from(H)]]:["has","ZCTA5CE20"];n.addLayer({id:"zips-fill",type:"fill",source:"zips","source-layer":"us_zip_codes",filter:L,paint:{"fill-color":I,"fill-opacity":.9}},O),n.addLayer({id:"zips-border",type:"line",source:"zips","source-layer":"us_zip_codes",filter:L,paint:{"line-color":"rgba(0,0,0,0.1)","line-width":.5}},O),(H||new Set(t.map(h=>h.zipCode))).forEach(h=>{const w=T[h];w&&n.setFeatureState({source:"zips",sourceLayer:"us_zip_codes",id:h},{metricValue:Fe(w,a)})}),n.triggerRepaint();const K=setInterval(()=>{n.loaded()&&n.isStyleLoaded()&&(clearInterval(K),M++,D())},250);setTimeout(()=>{E||(clearInterval(K),M++,D())},5e3)}catch(N){const O=N instanceof Error?N.message:"Unknown export map error";console.error(`[Export] Error initializing map ${F}:`,N),Pe("export_map_init_error",O),M++,D()}})};if(s==="national")G(m.current,"main",C||void 0,A),v.size>0&&G(x.current,"alaska",q||void 0,v),j.size>0&&G(R.current,"hawaii",X||void 0,j);else{const b=C||q||X,F=new Set(t.map(z=>z.zipCode));G(m.current,"main",b||void 0,F)}return()=>{Object.keys(g.current).forEach(b=>{g.current[b]?.remove(),g.current[b]=null})}},[s,r,a,t,v,j,A,q,X,C,f]),e.jsx("div",{className:"w-full h-full flex items-center justify-center overflow-hidden bg-muted/10 select-none",children:e.jsxs("div",{ref:d,style:{width:`${ke}px`,height:`${_e}px`,transform:`scale(${p})`,boxShadow:"0 4px 20px rgba(0,0,0,0.15)",backgroundColor:"#ffffff"},className:"flex flex-col flex-shrink-0 origin-center rounded-md",onContextMenu:S=>(S.preventDefault(),!1),children:[e.jsxs("div",{className:"flex items-start justify-between px-8 pt-6 pb-4",children:[i&&e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold leading-tight text-gray-900",children:[pr(a)," by ZIP Code"]}),e.jsxs("p",{className:"text-base mt-1 text-gray-500",children:[r," • ",hr()]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 whitespace-nowrap flex-shrink-0 ml-auto mt-1",children:[e.jsxs("span",{children:["Built by ",e.jsx("a",{href:"https://jasperc2024.github.io/Domapus/",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-600 hover:underline",children:"Domapus"})]}),e.jsx("span",{className:"opacity-60",children:"•"}),e.jsxs("span",{children:["Data: ",e.jsx("a",{href:"https://www.redfin.com/news/data-center/",target:"_blank",rel:"noopener noreferrer",className:"hover:underline",style:{color:"#0c82a5"},children:"Redfin"})," & ",e.jsx("a",{href:"https://www.zillow.com/research/data/",target:"_blank",rel:"noopener noreferrer",className:"hover:underline",style:{color:"#0c82a5"},children:"Zillow"})]})]})]}),e.jsxs("div",{className:"flex-1 mx-8 mb-6 relative bg-slate-50",children:[e.jsx("div",{ref:m,className:"absolute inset-0"}),s==="national"&&e.jsxs("div",{className:"absolute bottom-4 left-4 flex gap-4 z-10",children:[v.size>0&&e.jsxs("div",{className:"flex flex-col bg-white border border-gray-200",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wider font-semibold py-0.5 px-2 bg-slate-50 text-slate-500 border-b",children:"Alaska"}),e.jsx("div",{className:"w-48 h-32 relative",children:e.jsx("div",{ref:x,className:"absolute inset-0"})})]}),j.size>0&&e.jsxs("div",{className:"flex flex-col bg-white border border-gray-200",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wider font-semibold py-0.5 px-2 bg-slate-50 text-slate-500 border-b",children:"Hawaii"}),e.jsx("div",{className:"w-48 h-32 relative",children:e.jsx("div",{ref:R,className:"absolute inset-0"})})]})]}),c&&e.jsxs("div",{className:"absolute bottom-4 right-4 z-10 p-4 bg-white/95 backdrop-blur rounded-md",children:[e.jsx("div",{className:"h-4 w-56",style:{background:`linear-gradient(to right, ${ce.join(", ")})`,borderRadius:"4px"}}),e.jsxs("div",{className:"mt-2 flex justify-between text-xs font-semibold w-56 text-gray-600",children:[e.jsx("span",{children:$.min}),e.jsx("span",{children:$.mid}),e.jsx("span",{children:$.max})]})]}),!y&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/90 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-slate-200 border-t-cyan-600"}),e.jsx("span",{className:"text-sm font-medium text-slate-500",children:"Rendering map..."})]})})]})]})})});st.displayName="PrintStage";function jr({allZipData:t,selectedMetric:a,onClose:s}){const[r,c]=o.useState("national"),[i,f]=o.useState(""),[u,l]=o.useState(""),[d,m]=o.useState(""),[x,R]=o.useState(""),[g,y]=o.useState(!1),k=o.useRef(null),[p,_]=o.useState("png"),[T,v]=o.useState(!0),[j,A]=o.useState(!0),[q,X]=o.useState(!1),[C,J]=o.useState(!1),[V,$]=o.useState(!1),S=o.useRef(null);o.useEffect(()=>{const n=setTimeout(()=>R(d),150);return()=>clearTimeout(n)},[d]),o.useEffect(()=>{function n(N){k.current&&!k.current.contains(N.target)&&y(!1)}return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]),o.useEffect(()=>{$(!1)},[r,i,u,a,q]);const{availableStates:I,filteredMetros:M}=o.useMemo(()=>{if(Object.keys(t).length===0)return{availableStates:[],filteredMetros:[]};const n=new Set,N=new Set;for(const h of Object.values(t)){const w=h[a];w!=null&&(h.state&&n.add(h.state),h.metro&&N.add(h.metro))}const O=Array.from(n).map(h=>({code:h,name:Ne(h)})).sort((h,w)=>h.name.localeCompare(w.name)),L=Array.from(N);let K=L;if(x){const h=x.toLowerCase();K=L.filter(w=>w.toLowerCase().includes(h)),K.sort((w,B)=>{const Q=w.toLowerCase(),se=B.toLowerCase(),U=Q.indexOf(h),W=se.indexOf(h);return U!==W?U-W:w.localeCompare(B)})}else K.sort((h,w)=>h.localeCompare(w));return{availableStates:O,filteredMetros:K}},[t,a,x]),P=o.useMemo(()=>!!(r==="national"||r==="state"&&i||r==="metro"&&u),[r,i,u]),E=o.useMemo(()=>P?Object.keys(t).length===0?[]:Object.values(t).filter(n=>r==="state"&&i?n.state===i:r==="metro"&&u?n.metro===u:!0):[],[t,r,i,u,P]),D=o.useMemo(()=>r==="state"?Ne(i)||"Select a state":r==="metro"?u||"Select a metro area":"United States",[r,i,u]),G=()=>!!(C||!V||!P||E.length===0),b=()=>{if(C)return"Exporting...";if(!P){if(r==="state")return"Select a state";if(r==="metro")return"Select a metro"}return!V&&E.length>0?"Rendering...":`Export ${p.toUpperCase()}`},F=o.useCallback(async()=>{const n=S.current?.getElement();if(n){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"map_export_click",export_settings:{format:p,metric:a,scope:r,region_name:D,include_legend:T,include_title:j}}),J(!0);try{await new Promise(L=>requestAnimationFrame(L)),await new Promise(L=>setTimeout(L,500));const O=await Ft(n,{scale:5,useCORS:!0,backgroundColor:"#ffffff",logging:!1,allowTaint:!0});if(p==="png"){const L=document.createElement("a");L.download=`Domapus-${a}-${r}.png`,L.href=O.toDataURL("image/png",1),L.click()}else{const L=O.toDataURL("image/png",1),K={orientation:"l",unit:"mm",format:"a4"},h=new It(K);h.setProperties({title:`Domapus Export - ${a}`,subject:`Real Estate Data for ${D}`,creator:"Domapus (https://jasperc2024.github.io/Domapus/)"});const w=h.internal.pageSize.getWidth(),B=h.internal.pageSize.getHeight(),Q=O.width/O.height,se=w/B;let U,W,oe,ne;Q>se?(U=w,W=w/Q,oe=0,ne=(B-W)/2):(W=B,U=B*Q,oe=(w-U)/2,ne=0),h.addImage(L,"PNG",oe,ne,U,W);const ee=n.getBoundingClientRect();n.querySelectorAll("a").forEach(je=>{const ie=je.getBoundingClientRect(),at=(ie.left-ee.left)/ee.width,ot=(ie.top-ee.top)/ee.height,nt=ie.width/ee.width,it=ie.height/ee.height,ct=oe+at*U,lt=ne+ot*W,dt=nt*U,ut=it*W;h.link(ct,lt,dt,ut,{url:je.href})}),h.save(`Domapus-${a}-${r}.pdf`)}Se({title:"Export Complete",description:"Your map has been downloaded.",duration:1e4})}catch(N){console.error("Export failed:",N),Pe("export_failed",N?.message||"Unknown export error"),Se({title:"Export Failed",description:"Something went wrong.",variant:"destructive"})}finally{J(!1)}}},[p,a,r,D,T,j]),z=n=>{l(n),m(n),y(!1)},H=()=>{l(""),m(""),R(""),y(!0)};return e.jsxs("div",{className:"fixed inset-0 bg-background z-50 flex",children:[e.jsxs("div",{className:"w-80 bg-background border-r h-full shadow-xl flex flex-col",children:[e.jsxs("div",{className:"p-4 space-y-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(Re,{className:"h-4 w-4 text-primary"}),e.jsx("h2",{className:"text-base font-semibold",children:"Export Settings"})]}),e.jsxs("div",{className:"p-3 rounded-md border bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(At,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Region Scope"})]}),e.jsxs(be,{value:r,onValueChange:n=>c(n),className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"national",id:"r-national"}),e.jsx(Y,{htmlFor:"r-national",className:"text-sm",children:"National"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"state",id:"r-state"}),e.jsx(Y,{htmlFor:"r-state",className:"text-sm",children:"State"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"metro",id:"r-metro"}),e.jsx(Y,{htmlFor:"r-metro",className:"text-sm",children:"Metro Area"})]})]}),r==="state"&&e.jsxs(jt,{value:i,onValueChange:f,children:[e.jsx(Nt,{className:"h-9",children:e.jsx(St,{placeholder:"Select a state"})}),e.jsx(Rt,{children:I.map(n=>e.jsx(Ct,{value:n.code,children:n.name},n.code))})]}),r==="metro"&&e.jsxs("div",{className:"space-y-2 relative",ref:k,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Et,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(kt,{placeholder:"Type to search metros...",value:d,onChange:n=>{m(n.target.value),y(!0),u&&n.target.value!==u&&l("")},onFocus:n=>{y(!0);const N=n.currentTarget;setTimeout(()=>N.select(),0)},className:"pl-8 h-9 pr-8"}),d&&e.jsx("button",{onClick:H,className:"absolute right-2 top-2.5 text-muted-foreground hover:text-foreground",children:e.jsx(_t,{className:"h-4 w-4"})})]}),g&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-popover text-popover-foreground border rounded-md shadow-md max-h-[250px] overflow-y-auto",children:M.length>0?e.jsx("div",{className:"p-1",children:M.map(n=>e.jsx("div",{onClick:()=>z(n),className:fe("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground",u===n&&"bg-accent text-accent-foreground font-medium"),children:n},n))}):e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"No metro areas found."})})]})]}),e.jsxs("div",{className:"p-3 rounded-md border bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Pt,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"File Format"})]}),e.jsxs(be,{value:p,onValueChange:n=>_(n),className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"png",id:"r-png"}),e.jsx(Y,{htmlFor:"r-png",className:"text-sm",children:"PNG"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{value:"pdf",id:"r-pdf"}),e.jsx(Y,{htmlFor:"r-pdf",className:"text-sm",children:"PDF"})]})]})]}),e.jsxs("div",{className:"p-3 rounded-md border bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Lt,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Customization"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"c-title",checked:j,onCheckedChange:n=>A(n===!0)}),e.jsx(Y,{htmlFor:"c-title",className:"text-sm",children:"Include Title"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"c-legend",checked:T,onCheckedChange:n=>v(n===!0)}),e.jsx(Y,{htmlFor:"c-legend",className:"text-sm",children:"Include Legend"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:"c-cities",checked:q,onCheckedChange:n=>X(n===!0)}),e.jsx(Y,{htmlFor:"c-cities",className:"text-sm",children:"Show Cities"})]})]})]})]}),e.jsxs("div",{className:"p-4 space-y-2 border-t bg-background",children:[e.jsxs(Ce,{id:"btn-map-export",onClick:F,disabled:G(),className:"w-full",size:"default",children:[(C||!V&&P&&E.length>0)&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),!C&&P&&E.length>0&&V&&e.jsx(Re,{className:"h-4 w-4 mr-2"}),b()]}),e.jsx(Ce,{onClick:s,variant:"outline",className:"w-full",disabled:C,children:"Cancel"})]})]}),e.jsx("div",{className:"flex-1 p-6 overflow-hidden flex flex-col bg-muted/30",children:e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-0 w-full",children:P?e.jsx(st,{ref:S,filteredData:E,selectedMetric:a,regionScope:r,regionName:D,includeLegend:T,includeTitle:j,showCities:q,onReady:()=>$(!0)}):e.jsx("div",{className:"bg-white/50 border border-dashed rounded-lg w-full h-full flex items-center justify-center text-muted-foreground",children:r==="state"?"Select a state to preview":"Select a metro area to preview"})})})]})}export{jr as ExportSidebar};
